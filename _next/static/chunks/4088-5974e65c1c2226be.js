(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4088],{13210:function(t,e,i){"use strict";var r=i(85893);i(67294),e.Z=t=>{let{title:e,list:i,value:n,onSelect:s=()=>{},color:a,theme:o=1,className:h="",block:l=!1,grow:c}=t,handleSelectedElement=t=>s(t);return(0,r.jsxs)("div",{className:"".concat("list__","basis  ").concat(c&&"flex-1 !flex flex-col"," set-accent-color--").concat(a," selected theme-").concat(o," ").concat(h," ").concat(l?"block":""),role:"radiogroup",children:[e&&(0,r.jsx)("p",{className:"theme-".concat(o),children:e}),(0,r.jsx)("div",{className:"elements ".concat(c&&"flex-grow"),children:i.map(t=>(0,r.jsx)("div",{role:"radio","aria-checked":n===t,tabIndex:0,className:"".concat("list-element__","basis theme-").concat(o," ").concat(n===t?"selected ":""),onClick:()=>handleSelectedElement(t),title:t,children:t},t))})]})}},61267:function(t,e,i){"use strict";i.d(e,{N4:function(){return o},ST:function(){return c},defaultSelection:function(){return u},hk:function(){return l},jo:function(){return h},lB:function(){return a},nQ:function(){return d},rS:function(){return n},ug:function(){return r},x8:function(){return s}});let r=["SLM","SR","SP","SO"],n={1:{default:4472923,hover:8217967,selected:11962755,selectedEdges:15707799},2:{default:4472923,hover:8084330,selected:11761017,selectedEdges:15372424},3:{default:4472923,hover:7428464,selected:10449284,selectedEdges:13404825},4:{default:4472923,hover:6446455,selected:8420242,selectedEdges:10393774},5:{default:3751262,hover:5856633,selected:7240599,selectedEdges:8624309}},s={red:"#C46785",blue:"#3b4165",green:"#7FD982",purple:"#7F5482",yellow:"#f9f871"},a={experimental_data:"#EFAE97",reconstruction_data:"#EA9088",digital_reconstruction:"#CC8A99",validations:"#9E98AE",predictions:"#8398B5"},o=["all","axon","apical","basal","dendrite","soma"],h=["region","slice","cylinder"],l=["0um","10um","100um"],c=["All","Excitatory","Inhibitory","SLM_PPA","SO_BP","SO_BS","SO_OLM","SO_Tri","SP_AA","SP_BS","SP_CCKBC","SP_Ivy","SP_PC","SP_PVBC","SR_SCA"],u={experimentalData:{layerAnatomy:{layer:"SLM"},neuronMorphology:{layer:"SLM",mtype:"SLM_PPA",instance:"011127HP1"},neuronElectrophysiology:{etype:"bAC",etype_instance:"95810035"}},reconstructionData:{volume:{volume_section:"region"},cellComposition:{volume_section:"region"},neurons:{layer:"SLM",etype:"bAC",mtype:"SLM_PPA",instance:"CA1_int_bAC_011127HP1_20190329115610"}},digitalReconstruction:{region:{volume_section:"region"},morphologyLibrary:{layer:"SLM",etype:"bAC",mtype:"SLM_PPA",morphology:"011127HP1"},schafferCollateral:{volume_section:"region",prelayer:"SC",postlayer:"All"},connectionAnatomy:{volume_section:"region",prelayer:"All",postlayer:"All"},connectionPhysiology:{volume_section:"region",prelayer:"all",postlayer:"all"},acetylcholineEffectsOnCell:{morphology:"450290",etype:"cNAC",mtype:"SO_BP"},acetylcholineEffectsOnSynapses:{ach_concentration:"0um",prelayer:"Excitatory",postlayer:"Excitatory"},neurons:{layer:"SLM",etype:"bAC",mtype:"SLM_PPA",instance:"011127HP1"},NeuronModelLibrary:{mtype:"SO_BP",etype:"cNAC",morphology:"980120A_-_Scale_x1.000_y0.900_z1.000"},synapticPathways:{volume_section:"slice",prelayer:"All",postlayer:"All"},acetylcholine:{ach_concentration:"0um",prelayer:"Excitatory",postlayer:"Excitatory"}}},d={all:"#1fcf1f",axon:"#1111ff",apical:"#f442ad",basal:"#ff1111",dendrite:"#ff1111",soma:"#000"}},32071:function(t,e,i){"use strict";i.d(e,{f:function(){return SwcViewer}});var r=i(85893),n=i(67294),s=i(35829),a=i(43263),o=i.n(a),h=i(14561);let forEachLine=function*(t){let e=t.length,i=0,r=0;for(;i>-1&&i<e&&!((i=t.indexOf("\n",r))<0);)yield t.substring(r,i).trim(),r=i+1;return t.substring(r).trim()};var l=i(8380),c=i(35550);let Segments=class Segments{get count(){return this._count}addSegment(t,e){let{data:i}=this,r=this.elemByIndex.get(t);if("number"!=typeof r)return;let n=this.elemByIndex.get(e);if("number"!=typeof n)return;let s=this.nodesXYZR[r],a=this.nodesXYZR[n],o=this.nodesUV[r],h=this.nodesUV[n],l=this.nodesInfluence[r],c=this.nodesInfluence[n],u=(l+c)*.5,[,d]=o,[,m]=h;if(d===m)this.pushA(s,o,l),this.pushB(a,h,c),i.add(s,a,o,h,l,c),this._count++;else{let[t,e,r,n]=s,[d,m,f,g]=a,p=[(t+d)*.5,(e+m)*.5,(r+f)*.5,(n+g)*.5];this.pushA(s,o,l),this.pushB(p,o,l),i.add(s,p,o,o,l,u),this._count++,this.pushA(p,h,c),this.pushB(a,h,c),i.add(p,a,h,h,u,c),this._count++}}get data(){if(!this._data){this._data=new c.h3;for(let t=0;t<this.attAxyzr.length;t++){let e=this.attAxyzr[t],i=this.attAuv[t],r=this.attAinfluence[t],n=this.attBxyzr[t],s=this.attBuv[t],a=this.attBinfluence[t];this._data.add(e,n,i,s,r,a)}}return this._data}pushA(t,e,i){this.attAxyzr.push(t),this.attAuv.push(e),this.attAinfluence.push(i)}pushB(t,e,i){this.attBxyzr.push(t),this.attBuv.push(e),this.attBinfluence.push(i)}constructor(t){this._data=null,this._count=0,this.nodesXYZR=[],this.nodesUV=[],this.nodesInfluence=[],this.attAxyzr=[],this.attAuv=[],this.attAinfluence=[],this.attBxyzr=[],this.attBuv=[],this.attBinfluence=[],this.elemByIndex=new Map,t.forEach(t=>{let{index:e,type:i,x:r,y:n,z:s,radius:a,u:o,v:l}=t,c=this.nodesUV.length;this.nodesXYZR.push([r,n,s,a]),this.nodesUV.push([o,l]),this.nodesInfluence.push(i===h.d.Soma?0:1),this.elemByIndex.set(e,c)})}};let TipsPainter=class TipsPainter extends s.pD{delete(){this.vao.delete()}paint(){let{camera:t,context:e,prg:i,vao:r}=this,{gl:n}=e;t.orientation=e.camera.orientation,t.screenWidth=e.width,t.screenHeight=e.height,i.use(),this.texture.activate(i,"uniTexture"),i.uniform1f("uniScreenHeight",e.height),i.uniformMatrix4fv("uniModelViewMatrix",t.matrixModelView),i.uniformMatrix4fv("uniProjectionMatrix",t.matrixProjection),r.bind(),n.drawArrays(n.POINTS,0,6)}setTips(){let{canvas:t,ctx:e}=(0,s.nM)(768,512);paintDisk(e,0,0,256,"X","#f00","#fff"),paintDisk(e,1,0,256,"Y","#0f0","#000"),paintDisk(e,2,0,256,"Z","#00f","#fff"),paintDisk(e,0,1,256,"","#f00","#500"),paintDisk(e,1,1,256,"","#0f0","#050"),paintDisk(e,2,1,256,"","#00f","#005"),this.texture.loadImage(t)}constructor(t){super(),this.context=t,this.camera=new s.yr({distance:4,target:new s.Ui(0,0,0),fovy:Math.PI/4,near:1e-6,far:8}),this.texture=t.textures2D.create({minFilter:"LINEAR",magFilter:"LINEAR"}),this.setTips();let e=new s.Yp({attPos:"vec3",attUV:"vec2"});e.set("attPos",new Float32Array([1,0,0,0,1,0,0,0,1,-1,0,0,0,-1,0,0,0,-1]));let i=1/3;e.set("attUV",new Float32Array([0,0,i,0,2*i,0,0,.5,i,.5,2*i,.5]));let r=t.programs.create({vert:"#version 300 es\n\nprecision mediump float;\n\nuniform mat4 uniModelViewMatrix;\nuniform mat4 uniProjectionMatrix;\nuniform float uniScreenHeight;\n\n/**\n * Position of the tip.\n */\nin vec4 attPos;\nin vec2 attUV;\n\nout vec2 varUV;\n\nvoid main() {\n    varUV = attUV;\n    vec4 point = uniModelViewMatrix * attPos;\n    gl_Position = uniProjectionMatrix * point;\n    point.y += 0.3;\n    point = uniProjectionMatrix * point;\n    gl_PointSize = uniScreenHeight * abs(gl_Position.y / gl_Position.w - point.y / point.w);\n}\n",frag:"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D uniTexture;\n\nin vec2 varUV;\nout vec4 FragColor;\n\n\nvoid main() {\n    vec2 uv = varUV + gl_PointCoord * vec2(0.333333333, 0.5);\n    FragColor = texture(uniTexture, uv);\n    if (FragColor.w < 1.0) {\n        discard;\n    }\n}\n"}),n=t.createVAO(r,[e]);this.prg=r,this.vao=n}};function paintDisk(t,e,i,r,n,s){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"#fff",o=(e+.5)*r,h=(i+.5)*r,l=.45*r;t.fillStyle=s,t.beginPath(),t.ellipse(o,h,l,l,0,0,2*Math.PI),t.fill(),n?(t.font="bold ".concat(.5*r,"px sans-serif"),t.fillStyle=a,t.textAlign="center",t.textBaseline="middle",t.fillText(n,o,h)):(t.fillStyle=a,t.beginPath(),t.ellipse(o,h,.8*l,.8*l,0,0,2*Math.PI),t.fill())}let GizmoCanvas=class GizmoCanvas{attachCamera(t){this._camera=t;let{context:e}=this;e&&(e.camera=t)}get canvas(){return this._canvas}set canvas(t){var e;if(t===this._canvas)return;if(this._canvas=t,this.context){this.context.inputs.pointer.eventTap.removeListener(this.handleTap),this.context.destroy(),this.context=null;let t=this._orbiter;t&&t.detach()}if(null===(e=this._tipsPainter)||void 0===e||e.delete(),!t)return;let i=new s.Zc(t,{alpha:!0,depth:!0,antialias:!0,name:"GizmoCanvas"});i.inputs.pointer.eventTap.addListener(this.handleTap),this.context=i,this._camera&&(this.context.camera=this._camera),this._orbiter=new s.tz(i,{speedPanning:0,speedZoom:0}),this._orbiter.eventChange.addListener(t=>this.eventOrbit.dispatch(t));let r=new TipsPainter(i);this._tipsPainter=r,i.add(new s.Op(i,{color:[0,0,0,0],depth:1}),new s.TQ(i,{enabled:!0}),r),i.paint()}constructor(){this.eventOrbit=new s.C7,this.eventTipClick=new s.C7,this._canvas=null,this.context=null,this._camera=null,this._orbiter=null,this._tipsPainter=null,this.handleTap=t=>{var e;let i=null===(e=this._tipsPainter)||void 0===e?void 0:e.camera;if(!i)return;let{origin:r,direction:n}=i.castRay(t.x,t.y),a=1,o="+X+Y+Z";for(let[t,e]of u){let i=t.distanceToLineSquared(r,n);i<a&&(a=i,o=e)}if(a<1){let t=new s.EK;t.face(o),t.isEqual(i.orientation)&&t.rotateAroundY(Math.PI),this.eventTipClick.dispatch({from:new s.EK(i.orientation),to:t})}}}};let u=[[new s.Ui(1,0,0),"-Z+Y+X"],[new s.Ui(0,1,0),"+Z+X+Y"],[new s.Ui(0,0,1),"+X+Y+Z"],[new s.Ui(-1,0,0),"+Z+Y-X"],[new s.Ui(0,-1,0),"+Z-X-Y"],[new s.Ui(0,0,-1),"-X+Y-Z"]];function computeScalebarAttributes(t){let{preferedSizeInPixels:e=240,units:i={nm:.001,Âµm:1,mm:1e3,m:1e6,km:1e9},values:r=[1,2,5,10,20,25,50,75,100,200,300,400,500,600,700,800,900]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t*e;for(let e of Object.keys(i)){var s;let a=null!==(s=i[e])&&void 0!==s?s:1,o=n/a;for(let i of r)if(i>=o)return{sizeInPixel:i*a/t,value:i,unit:e}}return null}var d=i(86064),m=i.n(d);function Scalebar(t){let{className:e,pixelScaleWatcher:i,color:s="#000e"}=t,a=(0,n.useRef)(null),o=function(t){let[e,i]=(0,n.useState)(computeScalebarAttributes(t.pixelScale,f));return(0,n.useEffect)(()=>{let update=()=>{i(computeScalebarAttributes(t.pixelScale,f))};return t.eventPixelScaleChange.addListener(update),()=>t.eventPixelScaleChange.removeListener(update)},[t]),e}(i);return((0,n.useEffect)(()=>{let t=a.current;t&&o&&function(t,e,i){let r=t.getContext("2d");if(!r)return;let n=t.clientWidth,s=t.clientHeight;t.width=n,t.height=s,r.font="".concat(12,"px sans-serif"),r.fillStyle=i,r.strokeStyle=i;let a=.5,o=(12+s)/2,h=0;for(;a<n;){if(0===h);else{r.font="".concat(12,"px sans-serif");let t="".concat(h," ").concat(e.unit);r.fillText(t,a+3,o)}h+=e.value,r.beginPath(),r.moveTo(a,0),r.lineTo(a,s),r.stroke(),a+=e.sizeInPixel}}(t,o,s)},[o,s]),o)?(0,r.jsx)("div",{className:"".concat(m().main," ").concat(null!=e?e:""),children:(0,r.jsx)("canvas",{ref:a})}):null}let f={preferedSizeInPixels:100};let PixelScaleWatcher=class PixelScaleWatcher{get context(){return this._context}set context(t){this._context&&(this._context.eventResize.removeListener(this.handleCameraChange),this._context.camera.eventTransformChange.removeListener(this.handleCameraChange)),this._context=t,t&&(this.previousCameraHeight=-1,t.eventResize.addListener(this.handleCameraChange),t.camera.eventTransformChange.addListener(this.handleCameraChange),this.handleCameraChange())}get pixelScale(){let{context:t}=this;if(!t)return 1;let{camera:e}=t;return e.spaceHeightAtTarget/(e.zoom*e.screenHeight)}constructor(){this.eventPixelScaleChange=new s.C7,this.previousCameraHeight=-1,this.previousCameraZoom=-1,this.previousViewportHeight=-1,this._context=null,this.handleCameraChange=()=>{let{context:t}=this;if(!t)return;let{camera:e}=t,i=e.spaceHeightAtTarget,r=e.zoom,n=e.screenHeight;(i!==this.previousCameraHeight||r!==this.previousCameraZoom||n!==this.previousViewportHeight)&&(this.previousCameraHeight=i,this.previousCameraZoom=r,this.previousViewportHeight=n,this.eventPixelScaleChange.dispatch(this.pixelScale))}}};var g=i(42978),p=i(80671),x=i.n(p);function Legend(t){let{values:e}=t;return(0,r.jsxs)("div",{className:x().legend,children:[Array.isArray(e)&&(0,r.jsx)("div",{className:x().discrete,children:e.map(t=>{let{label:e,color:i}=t;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{background:i}}),(0,r.jsx)("div",{children:e})]},e)})}),!Array.isArray(e)&&(0,r.jsxs)("div",{className:x().continue,children:[(0,r.jsx)("div",{children:e.labelMin}),(0,r.jsx)("div",{className:x().colorramp,style:{background:"linear-gradient(to right,".concat(e.colorRamp.join(","),")")}}),(0,r.jsx)("div",{children:e.labelMax})]})]})}let v=["#333","#00f","#f00","#f0f","#8a8"],y=[{label:"Soma",color:"#333"},{label:"Axon",color:"#00f"},{label:"Dendrites",color:"#f00"}],defaultTextLoader=async t=>{try{let e=await fetch(t),i=await e.text();return{morphologies:[{nodes:function(t){let e=[];for(let i of forEachLine(t)){let t=function(t){let e=t.indexOf("#");return e<0?t:t.substring(0,e).trim()}(i),r=t.split(/\s+/);if(r.length<7)continue;let[n,s,a,o,l,c,u]=r.map(t=>Number(t)),d=s>0&&s<5?s:h.d.Unknown;e.push({index:n,parent:u,type:d,x:a,y:o,z:l,radius:c,u:0,v:(function(t){switch(t){case h.d.Soma:return 0;case h.d.Axon:return 1;case h.d.BasalDendrite:return 2;case h.d.ApicalDendrite:return 3;default:return 4}}(d)+.5)/5})}return new l.D(e)}(i),colors:v}]}}catch(e){throw console.error("Unable to fetch this URL:",t),console.error(e),Error("Unable to fetch ".concat(t,"!"))}};function SwcViewer(t){let{className:e,href:i,loader:a=defaultTextLoader,legend:l}=t,[c,u]=n.useState(l),[d,m]=n.useState(!1),[f,p]=n.useState(""),x=n.useRef(new PixelScaleWatcher),v=n.useRef(null),_=n.useRef(null),T=n.useRef(new GizmoCanvas),A=n.useRef(null);!function(t,e,i,r,a,o,l,c,u){let d=n.useRef(0);n.useEffect(()=>{let action=async()=>{t(!0),e(""),d.current++;let n=d.current;try{let t=i.current;if(!t)return;let e=await r(a);if(!e)return;e.legend&&u(e.legend);let n=o.current;if(n)n.removeAll();else{let e=new s.OY({near:.001,far:1e6});n=new s.Zc(t,{camera:e}),l.current.context=n;let i=new s.tz(n,{minZoom:.1,maxZoom:100,inertiaOrbit:500,fixedTarget:!0});i.enabled=!0;let r=c.current;r.attachCamera(e),r.eventTipClick.addListener(t=>(function(t,e){let{camera:i}=t;i.orientation=e.from,t.animSchedule({action:(0,s.xs)(i,{orientation:e.to}),duration:500,easingFunction:s.Jb}),t.paint()})(n,t)),r.eventOrbit.addListener(n.paint)}n.add(new s.Op(n,{color:[239/255,241/255,248/255,1],depth:1}),new s.TQ(n,{enabled:!0,func:"LESS",mask:!0,rangeMin:0,rangeMax:1}));let d=new s.Ui,m=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let{nodes:t,colors:i,texture:r,minRadius:a,roundness:o,center:l}of e.morphologies){d.add(null!=l?l:t.center);let e=.5*t.bbox[1];m=Math.min(m,t.center.y-e),f=Math.max(f,t.center.y+e);let c=function(t){let e=new Segments(t);return t.forEach(i=>{let{index:r,parent:n,type:s}=i;if(n<0)return;let a=t.getByIndex(n);if(!a)return;let o=a.type;(o!==h.d.Soma||s===h.d.Soma)&&e.addSegment(r,n)}),e.data}(t),u=new s.DY(n,c,{minRadius:null!=a?a:.25,roundness:o,colorTexture:n.textures2D.create({magFilter:"NEAREST",minFilter:"NEAREST",wrapR:"CLAMP_TO_EDGE",wrapS:"CLAMP_TO_EDGE",wrapT:"CLAMP_TO_EDGE",...r})});u.colorTexture.makePalette(i);let g=new s.DY(n,c,{minRadius:null!=a?a:.25,roundness:o,radiusMultiplier:1.2,light:0,shiftZ:2});n.add(u,g)}n.camera.spaceHeightAtTarget=Math.abs(f-m),d.scale(1/e.morphologies.length),n.camera.target=d,n.paint(),o.current=n}catch(i){if(console.error("Unable to load data for SwcViewer!",a),console.error(i),n<d.current)return;let t=i instanceof Error?i.message:JSON.stringify(i);e('Unable to load from "'.concat(a,'"!\n').concat(t))}finally{t(!1)}};action()},[a,r,i,o,c,l,t,e,u])}(m,p,_,a,i,A,x,T,u);let handleFullscreen=()=>(0,s.KI)(v.current);return(0,r.jsxs)("div",{className:(0,g.AK)(o().main,e),ref:v,onDoubleClick:handleFullscreen,children:[(0,r.jsx)("canvas",{ref:_}),(0,r.jsx)("canvas",{className:o().gizmo,ref:t=>{T.current.canvas=t}}),(0,r.jsx)("button",{onClick:handleFullscreen,children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[(0,r.jsx)("title",{children:"Toggle fullscreen"}),(0,r.jsx)("path",{fill:"currentColor",d:"M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z"})]})}),(0,r.jsx)(Scalebar,{className:o().scalebar,pixelScaleWatcher:x.current}),(0,r.jsx)(Legend,{values:null!=c?c:y}),d&&(0,r.jsx)("div",{className:o().busy,children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[(0,r.jsx)("title",{children:"loading"}),(0,r.jsx)("path",{d:"M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"})]})}),f&&(0,r.jsx)("div",{className:o().error,children:(0,r.jsx)("div",{children:f})})]})}},68009:function(t,e,i){"use strict";i.d(e,{OY:function(){return TgdCameraOrthographic},yr:function(){return TgdCameraPerspective}});var r=i(58124),n=i(43492);let TgdMat3=class TgdMat3 extends Float32Array{transpose(){let t=this.m10;return this.m10=this.m01,this.m01=t,t=this.m20,this.m20=this.m02,this.m02=t,t=this.m21,this.m21=this.m12,this.m12=t,this}fromQuat(t){let{x:e,y:i,z:r,w:n}=t,s=e+e,a=i+i,o=r+r,h=e*s,l=i*s,c=i*a,u=r*s,d=r*a,m=r*o,f=n*s,g=n*a,p=n*o;return this.m00=1-c-m,this.m10=l-p,this.m20=u+g,this.m01=l+p,this.m11=1-h-m,this.m21=d-f,this.m02=u-g,this.m12=d+f,this.m22=1-h-c,this}toAxis(t,e,i){return this.toAxisX(t),this.toAxisY(e),this.toAxisZ(i)}toAxisX(t){return t.x=this.m00,t.y=this.m01,t.z=this.m02,this}toAxisY(t){return t.x=this.m10,t.y=this.m11,t.z=this.m12,this}toAxisZ(t){return t.x=this.m20,t.y=this.m21,t.z=this.m22,this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this[4]*=t,this[5]*=t,this[6]*=t,this[7]*=t,this[8]*=t,this}get m00(){return this[0]}set m00(t){this[0]=t}get m01(){return this[1]}set m01(t){this[1]=t}get m02(){return this[2]}set m02(t){this[2]=t}get m10(){return this[3]}set m10(t){this[3]=t}get m11(){return this[4]}set m11(t){this[4]=t}get m12(){return this[5]}set m12(t){this[5]=t}get m20(){return this[6]}set m20(t){this[6]=t}get m21(){return this[7]}set m21(t){this[7]=t}get m22(){return this[8]}set m22(t){this[8]=t}debug(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Mat3",e=(0,n._)([this.m00,this.m01,this.m02]),i=(0,n._)([this.m10,this.m11,this.m12]),r=(0,n._)([this.m20,this.m21,this.m22]);console.log(t),console.log("   ",[e[0],i[0],r[0]].join(" | ")),console.log("   ",[e[1],i[1],r[1]].join(" | ")),console.log("   ",[e[2],i[2],r[2]].join(" | "))}constructor(t=1,e=0,i=0,r=0,n=1,s=0,a=0,o=0,h=1){"number"==typeof t?super([t,e,i,r,n,s,a,o,h]):super(t)}};var s=i(22508);let TgdCamera=class TgdCamera{get near(){return this._near}set near(t){t!==this._near&&(this._near=t,this.dirtyProjection=!0)}get far(){return this._far}set far(t){t!==this._far&&(this._far=t,this.dirtyProjection=!0)}get screenAspectRatio(){return this._screenAspectRatio}get screenWidth(){return this._screenWidth}set screenWidth(t){t!==this._screenWidth&&(this._screenWidth=t,this.dirtyProjection=!0,this._screenAspectRatio=this._screenWidth/this._screenHeight)}get screenHeight(){return this._screenHeight}set screenHeight(t){t!==this._screenHeight&&(this._screenHeight=t,this.dirtyProjection=!0,this._screenAspectRatio=this._screenWidth/this._screenHeight)}get spaceHeightAtTarget(){return this.getSpaceHeightAtTarget()}set spaceHeightAtTarget(t){this.setSpaceHeightAtTarget(t)}get spaceWidthAtTarget(){return this.screenWidth*this.spaceHeightAtTarget/this.screenHeight}set spaceWidthAtTarget(t){this.setSpaceHeightAtTarget(t*this.screenHeight/this.screenWidth)}face(t){this._orientation.face(t),this.dirtyModelView=!0,this.dirtyAxis=!0}from(t){let{_orientation:e,_target:i,distance:r,zoom:n,screenWidth:s,screenHeight:a}=t;return this._orientation.from(e),this._target.from(i),this.distance=r,this.zoom=n,this.screenWidth=s,this.screenHeight=a,this.dirtyModelView=!0,this.dirtyAxis=!0,this.copyProjectionFrom(t),this}get axisX(){return this.updateAxisIfNeeded(),this._axisX}get axisY(){return this.updateAxisIfNeeded(),this._axisY}get axisZ(){return this.updateAxisIfNeeded(),this._axisZ}get matrixModelView(){return this.updateIfNeeded(),this._matrixModelView}get matrixModelViewInverse(){return this.dirtyModelViewInverse&&(this._matrixModelViewInverse.invert(this.matrixModelView),this.dirtyModelViewInverse=!1),this._matrixModelViewInverse}get matrixProjectionInverse(){return this.dirtyProjectionInverse&&(this._matrixProjectionInverse.invert(this.matrixProjection),this.dirtyProjectionInverse=!1),this._matrixProjectionInverse}get orientation(){return this._orientation}set orientation(t){let{_orientation:e}=this;if(t.isEqual(e))return;let[i,r,n,s]=t;e.x=i,e.y=r,e.z=n,e.w=s,this.dirtyModelView=!0,this.dirtyAxis=!0}setOrientation(t,e,i,r){let{_orientation:n}=this;return n.x=t,n.y=e,n.z=i,n.w=r,this.dirtyModelView=!0,this.dirtyAxis=!0,this}get position(){return this.updateIfNeeded(),this._position}get target(){return this._target}set target(t){this._target.from(t),this.dirtyModelView=!0}setTarget(t,e,i){let{_target:r}=this;return r.x=t,r.y=e,r.z=i,this.dirtyModelView=!0,this}get shift(){return this._shift}set shift(t){this._shift.from(t),this.dirtyModelView=!0}setShift(t,e,i){let{_shift:r}=this;return r.x=t,r.y=e,r.z=i,this.dirtyModelView=!0,this}get x(){return this._target.x}set x(t){let{_target:e}=this;t!==e.x&&(e.x=t,this.dirtyModelView=!0)}get y(){return this._target.y}set y(t){let{_target:e}=this;t!==e.y&&(e.y=t,this.dirtyModelView=!0)}get z(){return this._target.z}set z(t){let{_target:e}=this;t!==e.z&&(e.z=t,this.dirtyModelView=!0)}get distance(){return this._distance}set distance(t){this._distance!==t&&(this._distance=t,this.dirtyModelView=!0)}get zoom(){return this._zoom}set zoom(t){this._zoom!==t&&(this._zoom=t,this.dirtyModelView=!0)}moveTarget(t,e,i){let{_target:r}=this;this.updateAxisIfNeeded();let{_axisX:n,_axisY:s,_axisZ:a,tmpVec3:o}=this;o.from(n).scale(t).addWithScale(s,e).addWithScale(a,i),r.x+=o.x,r.y+=o.y,r.z+=o.z,this.dirtyModelView=!0}moveShift(t,e,i){let[r,n,s]=this._shift;this._shift.reset(t+r,e+n,i+s),this._dirtyModelView=!0}orbitAroundX(t){this.updateAxisIfNeeded();let{_axisX:e,_axisY:i,_axisZ:r,_orientation:n}=this;return i.rotateAround(e,t),r.rotateAround(e,t),n.fromAxis(e,i,r),this.dirtyModelView=!0,this}orbitAroundY(t){this.updateAxisIfNeeded();let{_axisX:e,_axisY:i,_axisZ:r,_orientation:n}=this;return e.rotateAround(i,t),r.rotateAround(i,t),n.fromAxis(e,i,r),this.dirtyModelView=!0,this}orbitAroundZ(t){this.updateAxisIfNeeded();let{_axisX:e,_axisY:i,_axisZ:r,_orientation:n}=this;return e.rotateAround(r,t),i.rotateAround(r,t),n.fromAxis(e,i,r),this.dirtyModelView=!0,this}debug(t){this._orientation.debug("".concat(null!=t?t:this.name," quaternion:"))}updateAxisIfNeeded(){this.dirtyAxis&&this.updateAxis()}updateAxis(){let{tmpMat3:t}=this;t.fromQuat(this._orientation),t.toAxis(this._axisX,this._axisY,this._axisZ),this.dirtyAxis=!1}updateIfNeeded(){if(!this.dirtyModelView)return;let{tmpMat3:t,tmpVec3:e,_position:i}=this,r=this._matrixModelView;this.updateAxis();let n=this._distance,{x:s,y:a,z:o}=this._shift,{x:h,y:l,z:c}=this._target,{x:u,y:d,z:m}=this._axisZ;i.x=h+n*u,i.y=l+n*d,i.z=c+n*m,i.addWithScale(this._axisX,s),i.addWithScale(this._axisY,a),i.addWithScale(this._axisZ,o),e.from(i).applyMatrix(t.transpose()).scale(-1),r.m30=e.x,r.m31=e.y,r.m32=e.z,r.fromMat3(t),this.dirtyModelView=!1}get dirtyModelView(){return this._dirtyModelView}set dirtyModelView(t){this._dirtyModelView=t,t&&(this.dirtyModelViewInverse=!0,this.eventTransformChange.dispatch(this))}get dirtyAxis(){return this._dirtyAxis}set dirtyAxis(t){this._dirtyAxis=t}get dirtyProjection(){return this._dirtyProjection}set dirtyProjection(t){this._dirtyProjection=t,t&&(this.dirtyProjectionInverse=!0)}constructor(t={}){var e,i,n,a,o,h,l;this.eventTransformChange=new s.C,this._screenWidth=1920,this._screenHeight=1080,this._screenAspectRatio=1920/1080,this._dirtyModelView=!0,this.dirtyModelViewInverse=!0,this._dirtyAxis=!0,this._dirtyProjection=!0,this.dirtyProjectionInverse=!0,this._near=.001,this._far=1/0,this._axisX=new r.Ui,this._axisY=new r.Ui,this._axisZ=new r.Ui,this._matrixModelView=new r.Wk,this._matrixModelViewInverse=new r.Wk,this._matrixProjectionInverse=new r.Wk,this._orientation=new r.EK(0,0,0,1),this._shift=new r.Ui(0,0,0),this._target=new r.Ui(0,0,0),this._position=new r.Ui(0,0,0),this._distance=10,this._zoom=1,this.tmpMat3=new TgdMat3,this.tmpVec3=new r.Ui,this.name=null!==(e=t.name)&&void 0!==e?e:"TgdCamera#".concat(TgdCamera.incrementalId++),this._near=null!==(i=t.near)&&void 0!==i?i:.001,this._far=null!==(n=t.far)&&void 0!==n?n:1e6,this._distance=null!==(a=t.distance)&&void 0!==a?a:10,this._zoom=null!==(o=t.zoom)&&void 0!==o?o:1;let[c,u,d]=null!==(h=t.target)&&void 0!==h?h:[0,0,0];this.target.reset(c,u,d);let[m,f,g,p]=null!==(l=t.orientation)&&void 0!==l?l:[0,0,0,1];this.orientation.reset(m,f,g,p)}};TgdCamera.incrementalId=1;let TgdCameraOrthographic=class TgdCameraOrthographic extends TgdCamera{copyProjectionFrom(t){return this.spaceHeight=t.spaceHeight,this}castRay(t,e){let{origin:i,direction:r}=this._ray;r.from(this.axisZ);let n=.5*this.spaceHeight,s=n*this.screenAspectRatio;return i.from(this.position).addWithScale(this.axisX,s*t).addWithScale(this.axisY,n*e),this._ray}get spaceHeight(){return this._spaceHeight}set spaceHeight(t){t!==this._spaceHeight&&(this._spaceHeight=t,this.dirtyProjection=!0)}get near(){return this._near}set near(t){t!==this._near&&(this._near=t,this.dirtyProjection=!0)}get far(){return this._far}set far(t){t!==this._far&&(this._far=t,this.dirtyProjection=!0)}get matrixProjection(){return this.updateProjectionIfNeeded(),this._matrixProjection}getSpaceHeightAtTarget(){return this.spaceHeight}setSpaceHeightAtTarget(t){this.spaceHeight=t}updateProjectionIfNeeded(){if(!this.dirtyProjection)return;let{near:t,far:e,screenAspectRatio:i,_spaceHeight:r,zoom:n}=this,s=r/(n+n),a=-s,o=s*i,h=-o,l=this._matrixProjection,c=1/(h-o),u=1/(a-s),d=1/(t-e);l[0]=-2*c,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*u,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=d,l[11]=0,l[12]=(h+o)*c,l[13]=(s+a)*u,l[14]=t*d,l[15]=1,this.dirtyProjection=!0}constructor(t={}){var e;super(t),this._matrixProjection=new r.Wk,this._spaceHeight=10,this._ray={origin:new r.Ui,direction:new r.Ui},this.spaceHeight=null!==(e=t.spaceHeight)&&void 0!==e?e:10}};let TgdCameraPerspective=class TgdCameraPerspective extends TgdCamera{copyProjectionFrom(t){return this.fovy=t.fovy,this.near=t.near,this.far=t.far,this}castRay(t,e){let{origin:i,direction:r}=this._ray;i.from(this.position);let n=Math.atan(this.fovy),s=n*this.screenAspectRatio;return r.from(i).subtract(this.axisZ).addWithScale(this.axisX,s*t).addWithScale(this.axisY,n*e).subtract(i).normalize(),this._ray}get fovy(){return this._fovy}set fovy(t){t!==this._fovy&&(this._fovy=t,this.dirtyProjection=!0)}get matrixProjection(){return this.updateProjectionIfNeeded(),this._matrixProjection}getSpaceHeightAtTarget(){return 2*Math.tan(.5*this.fovy)*this.distance}setSpaceHeightAtTarget(t){this.distance=t/(2*Math.tan(.5*this.fovy))}updateProjectionIfNeeded(){if(!this.dirtyProjection)return;let t=this._fovy,e=this.screenAspectRatio,i=this._near,r=this._far,n=this._matrixProjection,s=this.zoom/Math.tan(t/2);if(n[0]=s/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,r!==1/0){let t=1/(i-r);n[10]=(r+i)*t,n[14]=2*r*i*t}else n[10]=-1,n[14]=-2*i;this.dirtyProjection=!0}constructor(t={}){var e;super(t),this._matrixProjection=new r.Wk,this._fovy=Math.PI/4,this._ray={origin:new r.Ui,direction:new r.Ui},this._fovy=null!==(e=t.fovy)&&void 0!==e?e:Math.PI/4}}},36317:function(t,e,i){"use strict";i.d(e,{Y:function(){return TgdDataset}});let TgdDataset=class TgdDataset{initialize(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null!==(e=i.divisor)&&void 0!==e?e:0,s=0,a={},o={};for(let e of Object.keys(t)){a[e]=new ArrayBuffer(0);let i={dimension:r[t[e]],byteOffset:s,bytesPerElement:Float32Array.BYTES_PER_ELEMENT,divisor:n,getter:(t,e)=>(e>=t.byteLength&&(e%=t.byteLength),t.getFloat32(e,!0)),setter(t,e,i){t.setFloat32(e,i,!0)}};o[e]=i,s+=i.bytesPerElement*i.dimension}this.definitions=o,this.stride=s}addAttributes(t){let e=this.clone();for(let e of Object.keys(t)){let i=this.attributesDefinition[e],r=t[e];if(i&&i!==r)throw Error('It is not allowed to change the type of attribute "'.concat(e,'" from "').concat(i,'" to "').concat(r,'"! Prefer removing the attribute first.'))}for(let i of(this.initialize({...this.attributesDefinition,...t},this.options),this.count=e.count,e.attributesNames)){let{get:t}=e.getAttribAccessor(i),{set:r}=this.getAttribAccessor(i);for(let n=0;n<e.count;n++){let e=this.getDef(i);for(let i=0;i<e.dimension;i++)r(t(n,i),n,i)}}}clone(){let t=new TgdDataset(this.attributesDefinition,this.options);t.count=this.count;let e=new DataView(this._data),i=new DataView(t._data);for(let t=0;t<e.byteLength;t++)i.setUint8(t,e.getUint8(t));return t}get data(){return this._data}get count(){return this._count}set count(t){this._count!==t&&(this._count=t,this._data=n(this._data,t*this.stride))}get attributesNames(){return Object.keys(this.attributesDefinition)}getAttribAccessor(t){let e=this.getDef(t),i=new DataView(this.data),r=this.stride;return{get(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=e.byteOffset+r*t+n*e.bytesPerElement;return e.getter(i,s)},set(t,n){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=e.byteOffset+r*n+s*e.bytesPerElement;e.setter(i,a,t)}}}set(t,e){let{byteOffset:i=0,byteStride:r,first:n=0,count:s=1/0,targetFirst:a=0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{bytesPerElement:o,dimension:h,byteOffset:l}=this.getDef(t),c=e instanceof ArrayBuffer?e:e.buffer,u=o*h,d=null!=r?r:u,m=i+d*n,f=this.stride,g=a*f+l;this.count=Math.max(this.count,Math.min(s,Math.floor((c.byteLength-m)/d)));let p=c.byteLength-d+1,x=this._data.byteLength+l-f+1,v=new Uint8Array(c),y=new Uint8Array(this._data),_=0;for(;_<s&&m<p&&g<x;)y.set(v.subarray(m,m+u),g),_++,m+=d,g+=f}getDef(t){let e=this.definitions[t];if(!e)throw Error('[TgdDataset] Attribute "'.concat(String(t),'" not found in this DataSet!\nAvailable names are: ').concat(Object.keys(this.definitions).map(t=>JSON.stringify(t)).join(", "),"."));return e}defineAttributes(t,e){let i=0,{definitions:r}=this;for(let n of Object.keys(r)){let s=r[n];if(e.hasAttribute(n)){let r=e.getAttribLocation(n);t.enableVertexAttribArray(r),t.vertexAttribPointer(r,s.dimension,t.FLOAT,!1,this.stride,i),t.vertexAttribDivisor(r,s.divisor)}let a=s.dimension*s.bytesPerElement;i+=a}}toCode(){let{indent:t=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[],i=0,{definitions:r}=this;for(let t of Object.keys(r)){let n=r[t],s="$".concat(t);e.push("const ".concat(s,' = gl.getAttribLocation(prg, "').concat(t,'")'),"gl.enableVertexAttribArray(".concat(s,")"),"gl.vertexAttribPointer(","  ".concat(s,","),"  ".concat(n.dimension,",  // Dimension"),"  gl.FLOAT,","  false,","  ".concat(this.stride,",   // Stride"),"  ".concat(i,"   // Offset"),")","gl.vertexAttribDivisor(".concat(s,", ").concat(n.divisor,")"));let a=n.dimension*n.bytesPerElement;i+=a}return e.map(e=>"".concat(t).concat(e)).join("\n")}constructor(t,e={}){var i,r;this.attributesDefinition=t,this.options=e,this.stride=0,this.definitions={},this._data=new ArrayBuffer(0),this._count=0,this.target=null!==(i=e.target)&&void 0!==i?i:"ARRAY_BUFFER",this.usage=null!==(r=e.usage)&&void 0!==r?r:"STATIC_DRAW",this.initialize(t,e)}};let r={float:1,vec2:2,vec3:3,vec4:4},n="function"==typeof ArrayBuffer.prototype.transfer?function(t,e){return t.transfer(e)}:function(t,e){let i=new ArrayBuffer(null!=e?e:t.byteLength);return new Uint8Array(i).set(new Uint8Array(t)),i}},78304:function(t,e,i){"use strict";i.d(e,{Y:function(){return r.Y}});var r=i(36317)},43492:function(t,e,i){"use strict";function padColOfNumbers(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,i=Math.pow(10,e),r=[],n=0;for(let s of t){let t=Math.round(s*i)/i,a=t.toFixed(e);n=Math.max(n,a.length),r.push(a)}return r.map(t=>t.padStart(n," "))}i.d(e,{_:function(){return padColOfNumbers}})},22508:function(t,e,i){"use strict";i.d(e,{C:function(){return TgdEvent}});let TgdEvent=class TgdEvent{addListener(t){this.listeners.add(t)}removeListener(t){this.listeners.delete(t)}dispatch(t){this.listeners.forEach(e=>e(t))}constructor(){this.listeners=new Set}}},35829:function(t,e,i){"use strict";i.d(e,{OY:function(){return r.OY},yr:function(){return r.yr},Zc:function(){return TgdContext},tz:function(){return TgdControllerCameraOrbit},Yp:function(){return c.Y},C7:function(){return n.C},pD:function(){return l.p},Op:function(){return u.Op},TQ:function(){return u.TQ},DY:function(){return u.DY},EK:function(){return o.EK},Ui:function(){return o.Ui},xs:function(){return tgdActionCreateCameraInterpolation},nM:function(){return tgdCanvasCreateWithContext2D},Jb:function(){return tgdEasingFunctionInOutCubic},KI:function(){return tgdFullscreenToggle}});var r=i(68009);let TgdBuffer=class TgdBuffer{get target(){return this._target}bind(t){let{gl:e,buffer:i}=this;this._target=null!=t?t:this._target,e.bindBuffer(e[this._target],i)}bufferData(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{gl:r}=this;this.bind(i.target),this._usage=null!==(e=i.usage)&&void 0!==e?e:this._usage,r.bufferData(r[this._target],t,r[this._usage])}delete(){let{gl:t,buffer:e}=this;t.deleteBuffer(e)}constructor(t,e,i){var r,n;this.gl=t;let s=t.createBuffer();if(!s)throw Error("Unable to create WebGLBuffer!");this._target=null!==(r=null==i?void 0:i.target)&&void 0!==r?r:"ARRAY_BUFFER",this._usage=null!==(n=null==i?void 0:i.usage)&&void 0!==n?n:"STATIC_DRAW",this.buffer=s,e&&this.bufferData(e,i)}};var n=i(22508);let TgdInputKeyboardImpl=class TgdInputKeyboardImpl{detach(){this.attached&&(document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.attached=!1)}isUp(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];return!this.isDown(...e)}isDown(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];for(let t of e)if(!this.keysDown.has(t))return!1;return!0}hasClicked(t){return!!this.keysUp.has(t)&&(this.keysUp.delete(t),!0)}constructor(){this.eventKeyPress=new n.C,this.keysDown=new Set,this.keysUp=new Set,this.attached=!1,this.handleKeyDown=t=>{this.keysDown.add(t.key),this.keysUp.delete(t.key)},this.handleKeyUp=t=>{this.keysDown.delete(t.key),this.keysUp.add(t.key),this.eventKeyPress.dispatch(t)},document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp),this.attached=!0}};let TgdInputPointerImpl=class TgdInputPointerImpl{detach(){let{canvas:t}=this;t&&(t.removeEventListener("pointerdown",this.handlePointerDown),t.removeEventListener("wheel",this.handleCanvasWheel),t.removeEventListener("contextmenu",this.handleContextMenu),t.removeEventListener("pointermove",this.handlePointerMove),t.removeEventListener("pointerup",this.handlePointerUp))}getPoint(t){this.controlKeys={altKey:t.altKey||2===t.buttons,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey};let{left:e,top:i,width:r,height:n}=this.canvas.getBoundingClientRect(),s=2*((t.clientX-e)/r-.5),a=-2*((t.clientY-i)/n-.5);return{x:s,y:a,t:t.timeStamp,fingersCount:1}}constructor(t){this.canvas=t,this.eventTap=new n.C,this.eventMoveStart=new n.C,this.eventMove=new n.C,this.eventMoveEnd=new n.C,this.eventZoom=new n.C,this.tapDelay=300,this.controlKeys={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1},this.start={x:0,y:0,t:0,fingersCount:1},this.current={x:0,y:0,t:0,fingersCount:1},this.previous={x:0,y:0,t:0,fingersCount:1},this.pointerEvent=null,this.handleContextMenu=t=>{t.preventDefault()},this.handleCanvasWheel=t=>{let e=t.deltaX+t.deltaY+t.deltaZ;e=e>0?1:-1,this.eventZoom.dispatch({current:this.getPoint(t),direction:e,preventDefault:()=>t.preventDefault(),...this.controlKeys})},this.handlePointerDown=t=>{if(!t.isPrimary)return;this.canvas.setPointerCapture(t.pointerId),t.preventDefault(),t.stopPropagation(),this.pointerEvent=t;let e=this.getPoint(t);this.start=this.current=this.previous=e,this.eventMoveStart.dispatch({start:e,current:e,previous:e,...this.controlKeys})},this.handlePointerMove=t=>{t.isPrimary&&this.pointerEvent&&this.canvas&&(this.previous=this.current,this.current=this.getPoint(t),this.eventMove.dispatch({start:this.start,current:this.current,previous:this.previous,...this.controlKeys}))},this.handlePointerUp=t=>{t.isPrimary&&this.pointerEvent&&(t.preventDefault(),this.current=this.getPoint(t),this.eventMoveEnd.dispatch({start:this.start,current:this.current,previous:this.previous,...this.controlKeys}),this.pointerEvent=null,t.timeStamp-this.start.t<this.tapDelay&&this.eventTap.dispatch({...this.start,...this.controlKeys}))},t.addEventListener("pointerdown",this.handlePointerDown,!0),t.addEventListener("wheel",this.handleCanvasWheel),t.addEventListener("contextmenu",this.handleContextMenu),t.addEventListener("pointermove",this.handlePointerMove),t.addEventListener("pointerup",this.handlePointerUp)}};let TgdInputs=class TgdInputs{get keyboard(){return this._keyboard||(this._keyboard=new TgdInputKeyboardImpl),this._keyboard}get pointer(){return this._pointer||(this._pointer=new TgdInputPointerImpl(this.canvas)),this._pointer}constructor(t){this.canvas=t,this._keyboard=null,this._pointer=null}};let s=1;let TgdResource=class TgdResource{create(t,e){var i,r;let n=null!==(i=null!=e?e:this.makeKeyFromInput(t))&&void 0!==i?i:"TgdResource:".concat(s++),a=null!==(r=this.references.get(n))&&void 0!==r?r:0;if(a<1){let e=this.actualCreate(t,n);return this.keys.set(e,n),this.objects.set(n,e),this.references.set(n,1),e}let o=this.objects.get(n);if(!o)throw Error("[TgdResource.create] Panic!");return this.references.set(n,a+1),o}delete(t){var e;let i=this.keys.get(t);if(!i)return;let r=null!==(e=this.references.get(i))&&void 0!==e?e:0;if(!(r<1)){if(r>1){this.references.set(i,r-1);return}this.keys.delete(t),this.objects.delete(i),this.references.delete(i),this.actualDelete(t)}}makeKeyFromInput(t){return null}constructor(){this.keys=new Map,this.objects=new Map,this.references=new Map}};let TgdProgramImpl=class TgdProgramImpl{toCode(){let{indent:t=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=["function createProgram(gl: WebGL2RenderingContext) {","  const prg = gl.createProgram()","  const vertexShader = gl.createShader(gl.VERTEX_SHADER)","  gl.shaderSource(vertexShader, `".concat(this.code.vert,"`)"),"  gl.compileShader(vertexShader)","  const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER)","  gl.shaderSource(fragmentShader, `".concat(this.code.frag,"`)"),"  gl.compileShader(fragmentShader)","  gl.attachShader(prg, vertexShader)","  gl.attachShader(prg, fragmentShader)","  gl.linkProgram(prg)","  return prg","}"];return e.map(e=>"".concat(t).concat(e)).join("\n")}hasAttribute(t){let{gl:e,program:i}=this,r=e.getAttribLocation(i,t);return r>=0}getAttribLocation(t){let{gl:e,program:i}=this,r=e.getAttribLocation(i,t);if(r<0)throw Error('Attribute "'.concat(t,'" not found!'));return r}getUniformLocation(t){let{uniformsLocations:e}=this,i=Object.keys(e);if(0===t.length)return console.warn('Uniform "'.concat(t,'" has not been found: there is no active uniform in this program!')),0;let r=e[t];return r||console.warn('No active uniform found with name "'.concat(t,'"!\nAvailable names are: ').concat(i.join(", "),".")),r}uniform1f(t,e){let{gl:i}=this;i.uniform1f(this.getUniformLocation(t),e)}uniform2f(t,e,i){let{gl:r}=this;r.uniform2f(this.getUniformLocation(t),e,i)}uniform3f(t,e,i,r){let{gl:n}=this;n.uniform3f(this.getUniformLocation(t),e,i,r)}uniform3fv(t,e){let{gl:i}=this;i.uniform3fv(this.getUniformLocation(t),e)}uniform4f(t,e,i,r,n){let{gl:s}=this;s.uniform4f(this.getUniformLocation(t),e,i,r,n)}uniform4fv(t,e){let{gl:i}=this;i.uniform4fv(this.getUniformLocation(t),e)}uniform1i(t,e){let{gl:i}=this;i.uniform1i(this.getUniformLocation(t),e)}uniform2i(t,e,i){let{gl:r}=this;r.uniform2i(this.getUniformLocation(t),e,i)}uniform3i(t,e,i,r){let{gl:n}=this;n.uniform3i(this.getUniformLocation(t),e,i,r)}uniform4i(t,e,i,r,n){let{gl:s}=this;s.uniform4i(this.getUniformLocation(t),e,i,r,n)}uniform1ui(t,e){let{gl:i}=this;i.uniform1ui(this.getUniformLocation(t),e)}uniform2ui(t,e,i){let{gl:r}=this;r.uniform2ui(this.getUniformLocation(t),e,i)}uniform3ui(t,e,i,r){let{gl:n}=this;n.uniform3ui(this.getUniformLocation(t),e,i,r)}uniform4ui(t,e,i,r,n){let{gl:s}=this;s.uniform4ui(this.getUniformLocation(t),e,i,r,n)}uniformMatrix4fv(t,e){let{gl:i}=this;i.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}use(){let{gl:t,program:e}=this;t.useProgram(e)}delete(){let{gl:t}=this;this.shaders.forEach(e=>t.deleteShader(e)),t.deleteProgram(this.program)}createShader(t,e){let{gl:i}=this,r=i.createShader(i[t]);if(!r)throw Error('Unable to create a WebGLShader of type "'.concat(t,'"!'));i.shaderSource(r,e),i.compileShader(r);let n=i.getShaderInfoLog(r);if(n){console.error("Error in ".concat(t," code:"),n);let i=getErrorLines(n);throw logCode(t,e,i),Error("Unable to compile ".concat(t,"!"))}return r}getUniformsLocations(){let{gl:t,program:e}=this,i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);if("number"!=typeof i)throw Error("Unable to get the number of uniforms in a WebGLProgram!");let r={};for(let n=0;n<i;n++){let i=t.getActiveUniform(e,n);if(!i)continue;let s=t.getUniformLocation(e,i.name);if(null===s)throw Error('Unable to get location for uniform "'.concat(i.name,'"!'));r[i.name]=s}return r}constructor(t,e){this.gl=t,this.code=e;let i=t.createProgram();if(!i)throw Error("Unable to create WebGLProgram!");let r=this.createShader("VERTEX_SHADER",e.vert);t.attachShader(i,r);let n=this.createShader("FRAGMENT_SHADER",e.frag);if(t.attachShader(i,n),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS)){var s;let r=null!==(s=t.getProgramInfoLog(i))&&void 0!==s?s:"";console.warn(r);let n=getErrorLines(r);throw logCode("Vertex Shader",e.vert,n),logCode("Fragment Shader",e.frag,n),Error("Could NOT link WebGL2 program!\n"+r)}this.program=i,this.shaders=[r,n],this.uniformsLocations=this.getUniformsLocations(),t.detachShader(i,r),t.deleteShader(r),t.detachShader(i,n),t.deleteShader(n)}};let a=/^ERROR:[ \t]+([0-9]+):([0-9]+):/g;function getErrorLines(t){let e=[],i=[];for(let r of t.split("\n")){a.lastIndex=-1;let t=a.exec(r);t&&(e.push(parseInt(t[2],10)),i.push(r.substring(t[0].length).trim()))}return{lines:e,messages:i}}function style(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"color:#fff;background:".concat(t,";font-family:monospace;font-size:80%;font-weight:").concat(e?"bolder":"100")}function logCode(t,e,i){console.log("%c".concat(t),"font-weight:bolder;font-size:120%"),e.split("\n").forEach((t,e)=>{let r=e+1,n=(1e-4*r).toFixed(4).substring(2),s=i.lines.includes(r)?"#f00":"#000";console.log("%c".concat(n,"  %c").concat(t),style(s),style(s,!0)),i.lines.includes(r)&&console.error(i.messages[i.lines.indexOf(r)])})}let TgdResourceProgram=class TgdResourceProgram extends TgdResource{actualCreate(t){return new TgdProgramImpl(this.gl,t)}actualDelete(t){t instanceof TgdProgramImpl&&t.delete()}makeKeyFromInput(t){return JSON.stringify(t)}constructor(t){super(),this.gl=t}};let TgdLoaderImage=class TgdLoaderImage{static async image(t){return new Promise(e=>{let i=new Image;i.onload=()=>e(i),i.onerror=()=>{console.error("Unable to load image: ",t),e(null)},i.src=t})}static async canvas(t){let e=await TgdLoaderImage.image(t);if(!e)return null;let i=document.createElement("canvas");i.width=e.naturalWidth,i.height=e.naturalHeight;let r=i.getContext("2d");if(!r)throw Error("Unable to get a 2D context!");return r.drawImage(e,0,0),i}};var o=i(58124),h=i(74509);function tgdActionCreateCameraInterpolation(t,e){var i,r,n,s,a,l;let c=t.spaceHeightAtTarget,u=t.distance,d=t.zoom,m=new o.EK(t.orientation),f=new o.Ui(t.target),g=new o.Ui(t.shift),p=null!==(i=e.spaceHeightAtTarget)&&void 0!==i?i:c,x=null!==(r=e.distance)&&void 0!==r?r:u,v=null!==(n=e.zoom)&&void 0!==n?n:d,y=new o.EK(null!==(s=e.orientation)&&void 0!==s?s:m),_=new o.Ui(null!==(a=e.target)&&void 0!==a?a:f),T=new o.Ui(null!==(l=e.shift)&&void 0!==l?l:g),A=new o.EK,w=new o.Ui,E=new o.Ui;return e=>{t.spaceHeightAtTarget=(0,h.C)(c,p,e),t.distance=(0,h.C)(u,x,e),t.zoom=(0,h.C)(d,v,e),t.orientation=A.fromSlerp(m,y,e).normalize(),t.target=w.fromMix(f,_,e),t.shift=E.fromMix(g,T,e)}}function tgdCanvasCreateWithContext2D(t,e,i){let r=document.createElement("canvas");r.width=t,r.height=e;let n=r.getContext("2d",i);if(!n)throw Error("Unable to create 2D context!");return{canvas:r,ctx:n}}function tgdEasingFunctionOutQuad(t){return 1-(1-t)*(1-t)}function tgdEasingFunctionInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}async function tgdFullscreenRequest(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{navigationUI:"hide"};if(!t)return!1;try{return await t.requestFullscreen(e),!0}catch(t){return!1}}async function tgdFullscreenExit(){if(!document.fullscreenElement)return!1;try{return await document.exitFullscreen(),!0}catch(t){return!1}}async function tgdFullscreenToggle(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{navigationUI:"hide"};return!!t&&(!function(t){let e=document.fullscreenElement;if(!t||!e)return!1;let i=t.parentElement;for(;i;){if(i===document.fullscreenElement)return e.clientWidth===t.clientWidth&&e.clientHeight===t.clientHeight;i=i.parentElement}return document.fullscreenElement===t}(t)?tgdFullscreenRequest(t,e):tgdFullscreenExit())}let TgdTexture2DImpl=class TgdTexture2DImpl{getParameter(t){let{context:e,glTexture:i}=this,{gl:r}=e;r.bindTexture(r.TEXTURE_2D,i);let n=r.getTexParameter(r.TEXTURE_2D,r[t]);return n}makePalette(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=(0,h.u)(e,1,t.length),r=Math.ceil(t.length/i),{canvas:n,ctx:s}=tgdCanvasCreateWithContext2D(i,r),a=0;for(let e=0;e<r;e++)for(let r=0;r<i;r++)s.fillStyle=t[a++],s.fillRect(r,e,1,1);this.loadImage(n)}fillHorizontalGradient(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];this.fillGradient(t,1,1,0,...i)}fillverticalGradient(t){for(var e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];this.fillGradient(1,t,0,1,...i)}fillGradient(t,e,i,r){for(var n=arguments.length,s=Array(n>4?n-4:0),a=4;a<n;a++)s[a-4]=arguments[a];let{canvas:o,ctx:h}=tgdCanvasCreateWithContext2D(t,e),l=h.createLinearGradient(0,0,t*i,e*r);for(let t=0;t<s.length;t++)l.addColorStop(t/(s.length-1),s[t]);h.fillStyle=l,h.fillRect(0,0,t,e),this.loadImage(o),o.style.position="fixed"}delete(){this.context.gl.deleteTexture(this.glTexture)}get image(){return this._image}get width(){return this._width}get height(){return this._height}bind(){let{gl:t}=this.context;t.bindTexture(t.TEXTURE_2D,this.glTexture)}activate(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,{context:r,glTexture:n}=this,{gl:s}=r;s.activeTexture(s.TEXTURE0+i),s.bindTexture(s.TEXTURE_2D,n),t.uniform1i(e,i)}loadImage(t){if("string"==typeof t){TgdLoaderImage.image(t).then(e=>{e?(this.loadImage(e),this.context.paint()):console.error("[TgdTexture2D] Unable to load image:",t)}).catch(console.error);return}let{context:e,glTexture:i}=this,{gl:r}=e;r.bindTexture(r.TEXTURE_2D,i),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),r.generateMipmap(r.TEXTURE_2D),this._width=t.width,this._height=t.height,this._image=t,this.eventImageUpdate.dispatch(this)}constructor(t,e,i={}){var r;this.context=t,this.id=e,this.eventImageUpdate=new n.C,this._width=0,this._height=0,this._image=null;let{gl:s}=t;this.options={wrapS:"REPEAT",wrapT:"REPEAT",wrapR:"REPEAT",minFilter:"NEAREST_MIPMAP_LINEAR",magFilter:"LINEAR",width:1,height:1,internalFormat:"RGBA",...i};let a=s.createTexture();if(!a)throw Error("Unable to create a WebGLTexture!");this.glTexture=a;let{wrapS:o="CLAMP_TO_EDGE",wrapT:h="CLAMP_TO_EDGE",wrapR:l="CLAMP_TO_EDGE",minFilter:c="LINEAR",magFilter:u="LINEAR",generateMipMap:d=!1,width:m=1,height:f=1,internalFormat:g="RGBA",data:p}=this.options,x=null!==(r=this.options.format)&&void 0!==r?r:g;s.bindTexture(s.TEXTURE_2D,a),s.texImage2D(s.TEXTURE_2D,0,s[g],m,f,0,s[x],s.UNSIGNED_BYTE,null!=p?p:null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s[o]),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s[h]),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_R,s[l]),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s[c]),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s[u]),i.image?this.loadImage(i.image):d&&s.generateMipmap(s.TEXTURE_2D)}};let TgdTextureCubeImpl=class TgdTextureCubeImpl{delete(){this.context.gl.deleteTexture(this.texture)}get ready(){return 0===this.numberOfImagesToLoad}get width(){return this._width}get height(){return this._height}bind(){let{gl:t}=this.context;t.bindTexture(t.TEXTURE_CUBE_MAP,this.texture)}activate(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.ready)return;let{context:r,texture:n}=this,{gl:s}=r;s.activeTexture(s.TEXTURE0+i),s.bindTexture(s.TEXTURE_CUBE_MAP,n),t.uniform1i(e,i)}loadImage(t,e){if("string"==typeof e){TgdLoaderImage.image(e).then(i=>{i?this.loadImage(t,i):console.error('[TgdTextureCube] Unable to load image "'.concat(e,'":'),e)}).catch(t=>{console.error('[TgdTextureCube] Unable to load image "'.concat(e,'":'),t)});return}let{width:i,height:r}=e;if(i!==r)throw Error("Images in a CubeMap must be squares, but we got ".concat(i,"\xd7").concat(r,"!"));if(0===this._width)this._width=i,this._height=r;else if(this._width!==i||this._height!==r)throw Error("Images in a CubeMap must all have the same size, but we got ".concat(this._width,"\xd7").concat(this._height," and ").concat(i,"\xd7").concat(r,"!"));let{context:n,texture:s}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_CUBE_MAP,s),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e instanceof Image),a.texImage2D(t,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e),this.numberOfImagesToLoad--,0===this.numberOfImagesToLoad&&(a.generateMipmap(a.TEXTURE_CUBE_MAP),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),n.paint())}constructor(t,e){this.context=t,this._width=0,this._height=0,this.numberOfImagesToLoad=6;let{gl:i}=t,r=i.createTexture();if(!r)throw Error("Unable to create a WebGLTexture!");this.texture=r,this.loadImage(i.TEXTURE_CUBE_MAP_POSITIVE_X,e.imagePosX),this.loadImage(i.TEXTURE_CUBE_MAP_NEGATIVE_X,e.imageNegX),this.loadImage(i.TEXTURE_CUBE_MAP_POSITIVE_Y,e.imagePosY),this.loadImage(i.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.imageNegY),this.loadImage(i.TEXTURE_CUBE_MAP_POSITIVE_Z,e.imagePosZ),this.loadImage(i.TEXTURE_CUBE_MAP_NEGATIVE_Z,e.imageNegZ)}};let TgdResourceTexture2D=class TgdResourceTexture2D extends TgdResource{getDefaultEmpty(){return this.create({width:1,height:1},"@tgd/DefaultTexture2D")}actualCreate(t,e){return new TgdTexture2DImpl(this.context,e,t)}actualDelete(t){t instanceof TgdTexture2DImpl&&t.delete()}constructor(t){super(),this.context=t}};let TgdResourceTextureCube=class TgdResourceTextureCube extends TgdResource{actualCreate(t){return new TgdTextureCubeImpl(this.context,t)}actualDelete(t){t instanceof TgdTextureCubeImpl&&t.delete()}constructor(t){super(),this.context=t}};let TgdVertexArray=class TgdVertexArray{toCode(){var t,e;let{indent:i=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=["function createVAO(","  gl: WebGL2RenderingContext,","  prg: WebGLProgram".concat(null===(t=this.datasets)||void 0===t?void 0:t.map((t,e)=>", data".concat(e,": ArrayBuffer")).join("")),") {","  const vao = gl.createVertexArray()","  gl.bindVertexArray(vao)"];return null===(e=this.datasets)||void 0===e||e.forEach((t,e)=>{r.push("  const buff".concat(e," = gl.createBuffer()"),"  gl.bindBuffer(gl.".concat(t.target,", buff").concat(e,")"),"  gl.bufferData(gl.".concat(t.target,", data").concat(e,", gl.").concat(t.usage,")"),t.toCode({indent:"".concat(i,"  ")}))}),r.push("  return vao","}"),r.map(t=>"".concat(i).concat(t)).join("\n")}bind(){this.gl.bindVertexArray(this.vao)}unbind(){this.gl.bindVertexArray(null)}delete(){let{gl:t,vao:e,drawBuffers:i,elemBuffer:r}=this;t.deleteVertexArray(e),i.forEach(t=>t.delete()),r&&r.delete()}constructor(t,e,i,r){this.gl=t,this.datasets=i,this.drawBuffers=[],this.elemBuffer=null;let n=t.createVertexArray();if(!n)throw Error("Unable to create VertexArrayObject!");if(this.vao=n,!e||!i)return;if(t.bindVertexArray(n),this.drawBuffers=i.map(i=>{let r=new TgdBuffer(t,i.data,{target:i.target,usage:i.usage});return r.bind(),i.defineAttributes(t,e),r}),r){let e=new TgdBuffer(t,r,{target:"ELEMENT_ARRAY_BUFFER"});e.bind(),this.elemBuffer=e}t.bindVertexArray(null)}};var l=i(49339);let TgdPainterGroup=class TgdPainterGroup extends l.p{forEachChild(t){this.painters.forEach((e,i)=>t(e,i))}has(t){return this.painters.includes(t)}add(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];for(let t of e)this.painters.push(t)}remove(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];for(let t of e){let e=this.painters.indexOf(t);e<0||(this.painters.splice(e,1),t.delete())}}removeAll(){for(let t of this.painters)t.delete();this.painters.splice(0,this.painters.length)}delete(){for(let t of this.painters)t.delete();this.painters.splice(0,this.painters.length)}paint(t,e){var i,r;if(this.active){for(let r of(null===(i=this.onEnter)||void 0===i||i.call(this,t,e),this.painters))r.active&&r.paint(t,e);null===(r=this.onExit)||void 0===r||r.call(this,t,e)}}constructor(t=[],{onEnter:e,onExit:i}={}){super(),this.active=!0,this.onEnter=e,this.onExit=i,this.painters=[...t]}};let TgdManagerAnimation=class TgdManagerAnimation{schedule(t){let{action:e,duration:i,easingFunction:r,repeat:n}=t;return this.animations.set(t,{start:-1,duration:i,inverseDuration:1/i,action:r?t=>e(r(t)):e,loop:1,repeat:null!=n?n:1,cancel:()=>this.cancel(t)}),t}cancel(t){this.animations.delete(t)}paint(t){if(0===this.animations.size)return!1;for(let e of this.animations.values()){e.start<0&&(e.start=t);let i=Math.min(1,e.inverseDuration*(t-e.start));e.action(i),t>e.start+e.duration&&e.loop++,e.loop>e.repeat&&e.cancel()}return!0}constructor(){this.animations=new Map}};let TgdContext=class TgdContext{get camera(){return this._camera}set camera(t){t!==this._camera&&(this._camera.eventTransformChange.removeListener(this.paint),t.eventTransformChange.addListener(this.paint),this._camera=t,this.paint())}get texturesCube(){return this._texturesCube||(this._texturesCube=new TgdResourceTextureCube(this)),this._texturesCube}animSchedule(t){let e=this.animationManager.schedule(t);return this.paint(),e}animCancel(t){this.animationManager.cancel(t)}get onEnter(){return this.painters.onEnter}set onEnter(t){this.painters.onEnter=t}get onExit(){return this.painters.onExit}set onExit(t){this.painters.onExit=t}get width(){return this.gl.drawingBufferWidth}get height(){return this.gl.drawingBufferHeight}get playing(){return this.isPlaying}set playing(t){t!==this.isPlaying&&(t&&this.paint(),this.isPlaying=t)}play(){this.playing=!0}pause(){this.playing=!1}has(t){return this.painters.has(t)}add(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];this.painters.add(...e)}remove(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];this.painters.remove(...e)}removeAll(){this.painters.removeAll()}createBuffer(t,e){return new TgdBuffer(this.gl,t,e)}createFramebuffer(){let t=this.gl.createFramebuffer();if(!t)throw Error("Unable to create a WebGL2 Framebuffer!");return t}createVAO(t,e,i){return new TgdVertexArray(this.gl,t,e,i)}takeSnapshot(t){let e=t.getContext("2d");if(!e)throw Error("[TgdContext.takeSnapshot] We cannot get a 2D context for the target canvas! Maybe it already has another type of context.");let{width:i,height:r}=t,n=function(t,e){let i=document.createElement("canvas");return i.width=t,i.height=e,i}(i,r),s=new TgdContext(n,this.options);this.painters.forEachChild(t=>s.add(t)),s.actualPaint(this.lastTime),s.gl.finish(),e.drawImage(n,0,0)}lookupWebglConstant(t){let{gl:e}=this;for(let i in e)if(e[i]===t)return i;return"Unknown gl[".concat(t,"]")}destroy(){window.cancelAnimationFrame(this.requestAnimationFrame),this.playing=!1,this.painters.delete(),this.observer.unobserve(this.canvas)}stateReset(){let{gl:t}=this,e=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);for(let i=0;i<e;++i)t.disableVertexAttribArray(i),t.vertexAttribPointer(i,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(i,0);t.deleteBuffer(i);let r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(let e=0;e<r;++e)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);return t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),t}constructor(t,e={}){var i,s;this.canvas=t,this.options=e,this.eventResize=new n.C,this._texturesCube=null,this.isPlaying=!1,this.requestAnimationFrame=-1,this.lastTime=-1,this.animationManager=new TgdManagerAnimation,this.paint=()=>{window.cancelAnimationFrame(this.requestAnimationFrame),this.requestAnimationFrame=window.requestAnimationFrame(this.actualPaint)},this.actualPaint=t=>{let{lastTime:e,gl:i}=this;if(e<0){this.lastTime=t,this.paint();return}let r=t-this.lastTime;this.lastTime=t,this._camera.screenWidth=i.drawingBufferWidth,this._camera.screenHeight=i.drawingBufferHeight,this.painters.paint(t,r),(this.animationManager.paint(t)||this.isPlaying)&&this.paint()};let a=t.getContext("webgl2",e);if(!a)throw Error("Unable to create a WebGL2 context!");this.gl=a,this.programs=new TgdResourceProgram(a),this.textures2D=new TgdResourceTexture2D(this),this.observer=new ResizeObserver(()=>{var i;let r=t.clientWidth,n=t.clientHeight;t.width=r,t.height=n,a.viewport(0,0,r,n),this.paint(),null===(i=e.onResize)||void 0===i||i.call(e,this,t.clientWidth,t.clientHeight),this.eventResize.dispatch(this)}),this.observer.observe(t),this.inputs=new TgdInputs(t),this._camera=null!==(i=e.camera)&&void 0!==i?i:new r.yr,this.painters=new TgdPainterGroup,this.name=null!==(s=e.name)&&void 0!==s?s:"TgdContext#".concat(TgdContext.incrementalId++),t.style.touchAction="none"}};TgdContext.incrementalId=1;let TgdControllerCameraOrbit=class TgdControllerCameraOrbit{detach(){let{inputs:t}=this.context;t.pointer.eventMove.removeListener(this.handleMove),t.pointer.eventZoom.removeListener(this.handleZoom)}orbit(t,e,i){let{context:r}=this,{camera:n}=r,{keyboard:s}=r.inputs,a=3*(i?.1:1)*this.speedOrbit;s.isDown("x")||n.orbitAroundY(-(t*a)),s.isDown("y")||n.orbitAroundX(e*a),this.fireOrbitChange()}handlePan(t){let{fixedTarget:e,speedPanning:i,context:r}=this,{camera:n}=r,s=1/n.zoom,a=.5*i*s,o=(t.current.x-t.previous.x)*a*n.spaceWidthAtTarget,h=(t.current.y-t.previous.y)*a*n.spaceHeightAtTarget;e?n.moveShift(-o,-h,0):n.moveTarget(-o,-h,0),this.fireOrbitChange()}handleRotateAroundZ(t){let{camera:e}=this.context,i=t.previous.x,r=t.previous.y;if(Math.abs(i)+Math.abs(r)===0)return;let n=t.current.x,s=t.current.y;if(Math.abs(n)+Math.abs(s)===0)return;let a=Math.atan2(i*s-r*n,i*n+r*s)*this.speedOrbit;e.orbitAroundZ(-a),this.fireOrbitChange()}fireOrbitChange(){this.context.paint(),this.eventChange.dispatch(this.context.camera)}fireZoomChange(){this.context.paint()}constructor(t,{minZoom:e=.001,maxZoom:i=1/0,speedZoom:r=1,speedOrbit:s=1,speedPanning:a=1,inertiaZoom:o=0,inertiaOrbit:l=0,inertiaPanning:c=0,fixedTarget:u=!1,onZoomRequest:d=alwaysTrue}={}){this.context=t,this.eventChange=new n.C,this.minZoom=.001,this.maxZoom=1/0,this.enabled=!0,this.speedZoom=1,this.speedOrbit=1,this.speedPanning=1,this.inertiaZoom=0,this.inertiaOrbit=0,this.inertiaPanning=0,this.fixedTarget=!1,this.animOrbit=null,this.handleMove=t=>{if(!this.enabled)return;let e=t.current.t-t.previous.t;if(e<=0)return;let{context:i}=this,{keyboard:r}=i.inputs;return t.altKey||2===t.current.fingersCount?this.handlePan(t):r.isDown("z")?this.handleRotateAroundZ(t):void this.orbit(t.current.x-t.previous.x,t.current.y-t.previous.y,t.shiftKey)},this.handleMoveStart=()=>{if(!this.enabled)return;let{animOrbit:t,context:e}=this;t&&e.animCancel(t)},this.handleMoveEnd=t=>{if(!this.enabled)return;let{context:e,inertiaOrbit:i}=this;if(i>0){let r=i/(t.current.t-t.previous.t),n=t.shiftKey,s=r*(t.current.x-t.previous.x),a=r*(t.current.y-t.previous.y),o=0;this.animOrbit={duration:i,action:t=>{let e=t-o;o=t,this.orbit(s*e,a*e,n)},easingFunction:tgdEasingFunctionOutQuad},e.animSchedule(this.animOrbit)}},this.handleZoom=t=>{if(!this.enabled||0===this.speedZoom||!this.onZoomRequest({altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,x:t.current.x,y:t.current.y}))return;let{context:e}=this,{camera:i}=e,r=.1*this.speedZoom;this.context.inputs.keyboard.isDown("Shift")&&(r*=.1);let n=-t.direction*r;i.zoom=(0,h.u)(i.zoom*(1+n),this.minZoom,this.maxZoom),t.preventDefault(),this.fireZoomChange()};let{inputs:m}=t;m.pointer.eventMoveStart.addListener(this.handleMoveStart),m.pointer.eventMoveEnd.addListener(this.handleMoveEnd),m.pointer.eventMove.addListener(this.handleMove),m.pointer.eventZoom.addListener(this.handleZoom),this.speedOrbit=s,this.speedZoom=r,this.speedPanning=a,this.inertiaOrbit=l,this.inertiaZoom=o,this.inertiaPanning=c,this.fixedTarget=u,this.minZoom=e,this.maxZoom=i,this.onZoomRequest=d}};let alwaysTrue=()=>!0;var c=i(78304),u=i(35550)},58124:function(t,e,i){"use strict";i.d(e,{Wk:function(){return TgdMat4},EK:function(){return s.E},Ui:function(){return n.U}});var r=i(43492),n=i(99287);let TgdMat4=class TgdMat4 extends Float32Array{multiply(t){let[e,i,r,n,s,a,o,h,l,c,u,d,m,f,g,p]=this,[x,v,y,_,T,A,w,E,b,M,P,C,S,R,U,I]=t;return this.m00=e*x+s*v+l*y+m*_,this.m10=e*T+s*A+l*w+m*E,this.m20=e*b+s*M+l*P+m*C,this.m30=e*S+s*R+l*U+m*I,this.m01=i*x+a*v+c*y+f*_,this.m11=i*T+a*A+c*w+f*E,this.m21=i*b+a*M+c*P+f*C,this.m31=i*S+a*R+c*U+f*I,this.m02=r*x+o*v+u*y+g*_,this.m12=r*T+o*A+u*w+g*E,this.m22=r*b+o*M+u*P+g*C,this.m32=r*S+o*R+u*U+g*I,this.m03=n*x+h*v+d*y+p*_,this.m13=n*T+h*A+d*w+p*E,this.m23=n*b+h*M+d*P+p*C,this.m33=n*S+h*R+d*U+p*I,this}invert(t){let[e,i,r,n,s,a,o,h,l,c,u,d,m,f,g,p]=null!=t?t:this,x=e*a-i*s,v=e*o-r*s,y=e*h-n*s,_=i*o-r*a,T=i*h-n*a,A=r*h-n*o,w=l*f-c*m,E=l*g-u*m,b=l*p-d*m,M=c*g-u*f,P=c*p-d*f,C=u*p-d*g,S=x*C-v*P+y*M+_*b-T*E+A*w;if(!S)return this;let R=1/S;return this[0]=(a*C-o*P+h*M)*R,this[1]=(r*P-i*C-n*M)*R,this[2]=(f*A-g*T+p*_)*R,this[3]=(u*T-c*A-d*_)*R,this[4]=(o*b-s*C-h*E)*R,this[5]=(e*C-r*b+n*E)*R,this[6]=(g*y-m*A-p*v)*R,this[7]=(l*A-u*y+d*v)*R,this[8]=(s*P-a*b+h*w)*R,this[9]=(i*b-e*P-n*w)*R,this[10]=(m*T-f*y+p*x)*R,this[11]=(c*y-l*T-d*x)*R,this[12]=(a*E-s*M-o*w)*R,this[13]=(e*M-i*E+r*w)*R,this[14]=(f*v-m*_-g*x)*R,this[15]=(l*_-c*v+u*x)*R,this}get translation(){let{m30:t,m31:e,m32:i}=this;return new n.U(t,e,i)}set translation(t){this.m30=t.x,this.m31=t.y,this.m32=t.z}from(t){let[e,i,r,n,s,a,o,h,l,c,u,d,m,f,g,p]=t;return this.m00=e,this.m01=i,this.m02=r,this.m03=n,this.m10=s,this.m11=a,this.m12=o,this.m13=h,this.m20=l,this.m21=c,this.m22=u,this.m23=d,this.m30=m,this.m31=f,this.m32=g,this.m33=p,this}fromMat3(t){return this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m20=t.m20,this.m21=t.m21,this.m22=t.m22,this}toAxis(t,e,i){return this.toAxisX(t),this.toAxisY(e),this.toAxisZ(i)}toAxisX(t){return t.x=this.m00,t.y=this.m01,t.z=this.m02,this}toAxisY(t){return t.x=this.m10,t.y=this.m11,t.z=this.m12,this}toAxisZ(t){return t.x=this.m20,t.y=this.m21,t.z=this.m22,this}fromQuat(t){let{x:e,y:i,z:r,w:n}=t,s=e+e,a=i+i,o=r+r,h=e*s,l=i*s,c=i*a,u=r*s,d=r*a,m=r*o,f=n*s,g=n*a,p=n*o;return this.m00=1-c-m,this.m10=l-p,this.m20=u+g,this.m01=l+p,this.m11=1-h-m,this.m21=d-f,this.m02=u-g,this.m12=d+f,this.m22=1-h-c,this}get m00(){return this[0]}set m00(t){this[0]=t}get m01(){return this[1]}set m01(t){this[1]=t}get m02(){return this[2]}set m02(t){this[2]=t}get m03(){return this[3]}set m03(t){this[3]=t}get m10(){return this[4]}set m10(t){this[4]=t}get m11(){return this[5]}set m11(t){this[5]=t}get m12(){return this[6]}set m12(t){this[6]=t}get m13(){return this[7]}set m13(t){this[7]=t}get m20(){return this[8]}set m20(t){this[8]=t}get m21(){return this[9]}set m21(t){this[9]=t}get m22(){return this[10]}set m22(t){this[10]=t}get m23(){return this[11]}set m23(t){this[11]=t}get m30(){return this[12]}set m30(t){this[12]=t}get m31(){return this[13]}set m31(t){this[13]=t}get m32(){return this[14]}set m32(t){this[14]=t}get m33(){return this[15]}set m33(t){this[15]=t}debug(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Mat4",e=(0,r._)([this.m00,this.m01,this.m02,this.m03]),i=(0,r._)([this.m10,this.m11,this.m12,this.m13]),n=(0,r._)([this.m20,this.m21,this.m22,this.m23]),s=(0,r._)([this.m30,this.m31,this.m32,this.m33]);console.log(t),console.log("   ",[e[0],i[0],n[0],s[0]].join(" | ")),console.log("   ",[e[1],i[1],n[1],s[1]].join(" | ")),console.log("   ",[e[2],i[2],n[2],s[2]].join(" | ")),console.log("   ",[e[3],i[3],n[3],s[3]].join(" | "))}constructor(t=1,e=0,i=0,r=0,n=0,s=1,a=0,o=0,h=0,l=0,c=1,u=0,d=0,m=0,f=0,g=1){"number"==typeof t?super([t,e,i,r,n,s,a,o,h,l,c,u,d,m,f,g]):super(t)}};var s=i(9565);i(31244)},9565:function(t,e,i){"use strict";i.d(e,{E:function(){return TgdQuat}});var r=i(99287);let TgdVec4=class TgdVec4 extends Float32Array{reset(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return this.x=t,this.y=e,this.z=i,this.w=r,this}from(t){let[e,i,r,n]=t;return this.x=e,this.y=i,this.z=r,this.w=n,this}clone(){return new TgdVec4(this)}isEqual(t){let[e,i,r,n]=t;return e===this.x&&i===this.y&&r===this.z&&n===this.w}isClose(t){let{x:e,y:i,z:r,w:n}=t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-6;return!(Math.abs(e-this.x)>s||Math.abs(i-this.y)>s||Math.abs(r-this.z)>s||Math.abs(n-this.w)>s)}applyMatrix(t){let{x:e,y:i,z:r,w:n}=this;return this.x=e*t.m00+i*t.m10+r*t.m20+n*t.m30,this.y=e*t.m01+i*t.m11+r*t.m21+n*t.m31,this.z=e*t.m02+i*t.m12+r*t.m22+n*t.m32,this.w=e*t.m03+i*t.m13+r*t.m23+n*t.m33,this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}add(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];for(let t of e)this[0]+=t[0],this[1]+=t[1],this[2]+=t[2],t.length>3&&(this[3]+=t[3]);return this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],t.length>3&&(this[3]-=t[3]),this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this[3]*=t,this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]+this[3]*t[3]}get size(){return Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]+this[3]*this[3])}normalize(){let t=this[0]*this[0]+this[1]*this[1]+this[2]*this[2]+this[3]*this[3];return 0===t?this:this.scale(1/Math.sqrt(t))}debug(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vec4",{x:e,y:i,z:r,w:n}=this,s=[e,i,r,n].map(t=>t.toFixed(6));console.log("".concat(t,":   "),s.join(" | "))}constructor(t=0,e=0,i=0,n=1){if(super(4),t instanceof TgdVec4){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w;return}if(t instanceof r.U){this.x=t.x,this.y=t.y,this.z=t.z,this.w=n;return}this.x=t,this.y=e,this.z=i,this.w=n}};let TgdQuat=class TgdQuat extends TgdVec4{clone(){return new TgdQuat(this)}multiply(t){let[e,i,r,n]=this,[s,a,o,h]=t;return this[0]=h*e+s*n-a*r+o*i,this[1]=h*i+s*r+a*n-o*e,this[2]=h*r-s*i+a*e+o*n,this[3]=h*n-s*e-a*i-o*r,this}fromSlerp(t,e,i){let r,n;let[s,a,o,h]=t,[l,c,u,d]=e,m=s*l+a*c+o*u+h*d;if(m<0&&(m=-m,l=-l,c=-c,u=-u,d=-d),1-m>1e-6){let t=Math.acos(m),e=1/Math.sin(t);r=Math.sin((1-i)*t)*e,n=Math.sin(i*t)*e}else r=1-i,n=i;return this.x=r*s+n*l,this.y=r*a+n*c,this.z=r*o+n*u,this.w=r*h+n*d,this}fromAxis(t,e,i){let r=t.x+e.y+i.z;if(r>0){let n=Math.sqrt(r+1);this.w=.5*n;let s=.5/n;this.x=(e.z-i.y)*s,this.y=(i.x-t.z)*s,this.z=(t.y-e.x)*s}else{let r=[t,e,i],n=0;e.y>t.x&&(n=1),i.z>r[n][n]&&(n=2);let s=(n+1)%3,a=(n+2)%3,o=Math.sqrt(r[n][n]-r[s][s]-r[a][a]+1);this[n]=.5*o,o=.5/o,this[3]=(r[s][a]-r[a][s])*o,this[s]=(r[s][n]+r[n][s])*o,this[a]=(r[a][n]+r[n][a])*o}return this.normalize()}rotateAroundX(t){let e=.5*t,i=this[0],r=this[1],n=this[2],s=this[3],a=Math.sin(e),o=Math.cos(e);return this[0]=i*o+s*a,this[1]=r*o+n*a,this[2]=n*o-r*a,this[3]=s*o-i*a,this}rotateAroundY(t){let e=.5*t,i=this[0],r=this[1],n=this[2],s=this[3],a=Math.sin(e),o=Math.cos(e);return this[0]=i*o-n*a,this[1]=r*o+s*a,this[2]=n*o+i*a,this[3]=s*o-r*a,this}rotateAroundZ(t){let e=.5*t,i=this[0],r=this[1],n=this[2],s=this[3],a=Math.sin(e),o=Math.cos(e);return this[0]=i*o+r*a,this[1]=r*o-i*a,this[2]=n*o+s*a,this[3]=s*o-n*a,this}toAxisZ(t){let{x:e,y:i,z:r,w:n}=this,s=e+e,a=i+i;return t.x=r*s+n*a,t.y=r*a-n*s,t.z=1-e*s-i*a,t}face(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"+X+Y+Z",[e,i,r,n]=s[t];return this.x=e,this.y=i,this.z=r,this.w=n,this}constructor(t=0,e=0,i=0,r=1){"number"==typeof t?super(t,e,i,r):super(t)}};let n=Math.sqrt(2)/2,s={"+X+Y+Z":[0,0,0,1],"-Z+Y+X":[0,+n,0,+n],"-X+Y-Z":[0,1,0,0],"+Z+Y-X":[0,-n,0,+n],"+X+Z-Y":[+n,0,0,+n],"+Y+Z+X":[.5,.5,.5,.5],"-X+Z+Y":[0,+n,+n,0],"-Y+Z-X":[.5,-.5,-.5,.5],"+X-Y-Z":[1,0,0,0],"+X-Z+Y":[-n,0,0,+n],"-X-Y+Z":[0,0,1,0],"-X-Z-Y":[0,+n,-n,0],"+Y+X-Z":[+n,+n,0,0],"+Y-X+Z":[0,0,+n,+n],"+Y-Z-X":[.5,.5,-.5,-.5],"-Y+X+Z":[0,0,-n,+n],"-Y-X-Z":[+n,-n,0,0],"-Y-Z+X":[.5,-.5,.5,-.5],"+Z+X+Y":[.5,.5,.5,-.5],"+Z-X-Y":[.5,-.5,.5,.5],"+Z-Y+X":[+n,0,+n,0],"-Z+X-Y":[.5,.5,-.5,.5],"-Z-X+Y":[.5,-.5,-.5,-.5],"-Z-Y-X":[+n,0,-n,0]}},31244:function(t,e,i){"use strict";i(9565)},99287:function(t,e,i){"use strict";i.d(e,{U:function(){return TgdVec3}});var r=i(74509);let TgdVec3=class TgdVec3 extends Float32Array{static newFromMix(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,r=1-i,n=r*t.x+i*e.x,s=r*t.y+i*e.y,a=r*t.z+i*e.z;return new TgdVec3(n,s,a)}static distance(t,e){let i=e.x-t.x,r=e.y-t.y,n=e.z-t.z;return Math.sqrt(i*i+r*r+n*n)}clone(){return new TgdVec3(this)}isEqual(t){let[e,i,r]=t;return e===this.x&&i===this.y&&r===this.z}isClose(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-6,[i,r,n]=t;return!(Math.abs(i-this.x)>e||Math.abs(r-this.y)>e||Math.abs(n-this.z)>e)}rotateAround(t,e){let i=Math.cos(e),r=Math.sin(e),[n,s,a]=this,[o,h,l]=t,c=(n*o+s*h+a*l)*(1-i);return this.x=n*i+(h*a-l*s)*r+o*c,this.y=s*i+(l*n-o*a)*r+h*c,this.z=a*i+(o*s-h*n)*r+l*c,this}applyMatrix(t){let{x:e,y:i,z:r}=this;return this.x=e*t.m00+i*t.m10+r*t.m20,this.y=e*t.m01+i*t.m11+r*t.m21,this.z=e*t.m02+i*t.m12+r*t.m22,this}from(t){let[e,i,r]=t;return this.x=e,this.y=i,this.z=r,this}fromMix(t,e,i){let[n,s,a]=t,[o,h,l]=e;return this.reset((0,r.C)(n,o,i),(0,r.C)(s,h,i),(0,r.C)(a,l,i))}reset(t,e,i){return this[0]=t,this[1]=e,this[2]=i,this}distanceToLineSquared(t,e){let[i,r,n]=this,[s,a,o]=t,[h,l,c]=e,u=h*(i-s)+l*(r-a)+c*(n-o),d=i-(s+u*h),m=r-(a+u*l),f=n-(o+u*c);return d*d+m*m+f*f}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}add(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];for(let t of e)this[0]+=t.x,this[1]+=t.y,this[2]+=t.z;return this}addWithScale(t,e){return this[0]+=t.x*e,this[1]+=t.y*e,this[2]+=t.z*e,this}subtract(t){return this[0]-=t[0],this[1]-=t[1],this[2]-=t[2],this}scale(t){return this[0]*=t,this[1]*=t,this[2]*=t,this}dot(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]}get size(){return Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2])}normalize(){let t=this[0]*this[0]+this[1]*this[1]+this[2]*this[2];return 0===t?this:this.scale(1/Math.sqrt(t))}cross(t){let[e,i,r]=this,[n,s,a]=t;return this[0]=i*a-s*r,this[1]=r*n-a*e,this[2]=e*s-n*i,this}random(){return this[0]=Math.random()-.5,this[1]=Math.random()-.5,this[2]=Math.random()-.5,this}debug(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vec3",{x:e,y:i,z:r}=this,n=[e,i,r].map(t=>t.toFixed(6));console.log("".concat(t,":   "),n.join(" | "),"   length:",Math.sqrt(e*e+i*i+r*r))}constructor(t=0,e=0,i=0){if(super(3),"number"!=typeof t){this.x=t[0],this.y=t[1],this.z=t[2];return}this.x=t,this.y=e,this.z=i}}},35550:function(t,e,i){"use strict";i.d(e,{Op:function(){return TgdPainterClear},TQ:function(){return TgdPainterDepth},DY:function(){return TgdPainterSegments},h3:function(){return TgdPainterSegmentsData}});var r=i(78304);i(58124),i(36317);var n=i(49339);let TgdPainterClear=class TgdPainterClear extends n.p{delete(){}paint(){let{clearMask:t,context:e,red:i,green:r,blue:n,alpha:s,depth:a,options:o}=this,{gl:h}=e;o.color&&h.clearColor(i,r,n,s),"number"==typeof o.depth&&h.clearDepth(a),h.clear(t)}constructor(t,e={}){var i,r;super(),this.context=t,this.options=e,this.red=1,this.green=.7,this.blue=0,this.alpha=1,this.depth=1;let{gl:n}=t,s=null!==(i=e.color)&&void 0!==i?i:[0,0,0,1],a=null!==(r=e.depth)&&void 0!==r?r:1;this.clearMask=0;let o=!1;if(e.color&&(this.clearMask|=n.COLOR_BUFFER_BIT,o=!0),"number"==typeof e.depth&&(this.clearMask|=n.DEPTH_BUFFER_BIT,o=!0),!o)throw Error("[TgdPainterClear] You must give at least a color or a depth in the constructor!");[this.red,this.green,this.blue,this.alpha]=s,this.depth=a}};let TgdPainterDepth=class TgdPainterDepth extends n.p{delete(){}paint(){let{gl:t}=this.context,{enabled:e}=this;if(!e){t.disable(t.DEPTH_TEST);return}let{func:i,mask:r,rangeMin:n,rangeMax:s}=this;t.enable(t.DEPTH_TEST),t.depthFunc(t[i]),t.depthMask(r),t.depthRange(n,s)}update(){}constructor(t,{enabled:e=!0,func:i="LESS",mask:r=!0,rangeMin:n=0,rangeMax:s=1}={}){super(),this.context=t,this.enabled=e,this.func=i,this.mask=r,this.rangeMin=n,this.rangeMax=s}};i(31244);let TgdPainterSegments=class TgdPainterSegments extends n.p{delete(){this.vao.delete()}paint(t,e){let{context:i,prg:r,vao:n,colorTexture:s,vertexCount:a,instanceCount:o,light:h,radiusMultiplier:l,radiusConstant:c,radiusSwitch:u,shiftZ:d}=this,{gl:m,camera:f}=i;r.use();let g=this.minRadius*f.spaceHeightAtTarget/(f.zoom*f.screenHeight);r.uniform1f("uniMinRadius",g),r.uniform1f("uniLight",h),r.uniform1f("uniShiftZ",d),r.uniform1f("uniRadiusMultiplier",l),r.uniform1f("uniRadiusConstant",c),r.uniform1f("uniRadiusSwitch",u),s.activate(r,"uniTexture"),r.uniformMatrix4fv("uniModelViewMatrix",f.matrixModelView),r.uniformMatrix4fv("uniProjectionMatrix",f.matrixProjection),n.bind(),m.drawElementsInstanced(m.TRIANGLES,a,m.UNSIGNED_BYTE,0,o)}constructor(t,e,i={}){super(),this.context=t,this.minRadius=0,this.radiusMultiplier=1,this.radiusConstant=1,this.radiusSwitch=0,this.light=1,this.shiftZ=0;let{roundness:n=3,minRadius:s=0,colorTexture:a,radiusMultiplier:o=1,light:h=1,shiftZ:l=0}=i;if(this.minRadius=s,this.radiusMultiplier=o,this.light=h,this.shiftZ=l,n>125)throw Error("[TgdPainterSegments] Max roundness is 125!");if(n<0)throw Error("[TgdPainterSegments] Min roundness is 0!");let c=null!=a?a:t.textures2D.create({magFilter:"NEAREST",minFilter:"NEAREST",wrapR:"CLAMP_TO_EDGE",wrapS:"CLAMP_TO_EDGE",wrapT:"CLAMP_TO_EDGE"});a||c.makePalette(["#f00","#0f0","#00f"]),this.colorTexture=c;let u=t.programs.create({vert:"#version 300 es\n\nprecision mediump float;\n\nuniform sampler2D uniTexture;\nuniform mat4 uniModelViewMatrix;\nuniform mat4 uniProjectionMatrix;\n// Minimal value for the radius.\nuniform float uniMinRadius;\n// Multiply all radii by this value.\nuniform float uniRadiusMultiplier;\n// When uniRadiusSwitch == 1.0,\n// we use uniRadiusConstant as radius. \nuniform float uniRadiusConstant;\n// 0.0 means we will use the radius defined\n// in the attribute attAxyzr or attBaxyz.\n// 1.0 means we use uniRadiusConstant for\n// all vertices.\nuniform float uniRadiusSwitch;\n// Multiply the color by this value;\nuniform float uniLight;\n// Push the segments away from camera of `uniShiftZ`.\n// This can be used if you want contours on the segments:\n// just increase `uniRadiusMultiplier`, set a low `uniLight`,\n// and set a small positive `uniShiftZ`.\nuniform float uniShiftZ;\n\n//===================\n// Vertex attributes\n//-------------------\n\n// Position of the vertex, relative to\n// the current center and assuming a\n// radius of 1.\n// Z tells you what tip is your center: 0 for A and 1 for B.\nin vec3 attOffset;\n\n//=====================\n// Instance attributes\n//---------------------\n\n// Coords and radious of tip A.\nin vec4 attAxyzr;\n// Coords and radious of tip B.\nin vec4 attBxyzr;\n// The color is taken from a texture.\nin vec2 attAuv;\nin vec2 attBuv;\n// 0 means that nothing modifies the initial radius,\n// except the minRadius.\nin float attAinfluence;\nin float attBinfluence;\n\n\nout vec4 varColor;\n\n\nvec3 worldToCamera(vec3 v);\nfloat getRadius(float tip);\nmat3 getTransfoMatrix(float tip, vec3 camA, vec3 camB);\n\nvoid main() {\n    vec3 camA = worldToCamera(attAxyzr.xyz);\n    vec3 camB = worldToCamera(attBxyzr.xyz);\n    float tip = attOffset.z;\n    vec2 uv = mix(attAuv, attBuv, tip);\n    varColor = texture(uniTexture, uv)\n        *   vec4(uniLight, uniLight, uniLight, 1.0);\n    float radius = getRadius(tip);\n    mat3 transfo = getTransfoMatrix(tip, camA, camB);\n    vec3 point = transfo * vec3(attOffset.xy * radius, 1.0);\n    point.z -= uniShiftZ;\n    gl_Position = \n        uniProjectionMatrix \n        * vec4(point, 1);\n}\n\nfloat getRadius(float tip) {\n    float influence = mix(attAinfluence, attBinfluence, tip);\n    float originalRadius = mix(\n        attAxyzr.w,\n        attBxyzr.w,\n        tip\n    );\n    float modifiedRadius = mix(\n        originalRadius,\n        uniRadiusConstant,\n        uniRadiusSwitch\n    );\n    float radius = mix(\n        originalRadius,\n        modifiedRadius,\n        influence\n    );\n    return max(uniMinRadius, radius) * uniRadiusMultiplier;\n}\n\nvec3 worldToCamera(vec3 v) {\n    vec4 result = uniModelViewMatrix * vec4(v, 1.0);\n    return result.xyz;\n}\n\nmat3 getTransfoMatrix(float tip, vec3 camA, vec3 camB) {\n    // What is the current tip?\n    vec3 camO = mix(camA, camB, tip);\n    vec2 A = camA.xy;\n    vec2 B = camB.xy;\n    vec3 Y = vec3(\n        A == B ? vec2(0, 1) : normalize(A - B),\n        0\n    );\n    vec3 X = vec3(Y.y, -Y.x, 0);\n    return mat3(X, Y, camO);\n}\n",frag:"#version 300 es\n\nprecision mediump float;\n\nin vec4 varColor;\nout vec4 FragColor;\n\n\nvoid main() {\n    if (varColor.a < 0.01) discard;\n    else FragColor = varColor;\n}\n"});this.prg=u;let{capsule:d,elements:m}=function(t){let e=[0,0,0,1,0,0,-1,0,0,0,0,1,1,0,1,-1,0,1],i=[0,3,1,3,4,1,0,2,5,3,0,5];if(t>0){let r=1,n=4,s=6;for(let a=0;a<t;a++){let o=Math.PI*(a+1)/(t+1),h=Math.cos(o),l=Math.sin(o);e.push(h,l,0),i.push(0,r,s),r=s,s++,e.push(h,-l,1),i.push(3,s,n),n=s,s++}i.push(0,r,2),i.push(3,5,n)}let n=new r.Y({attOffset:"vec3"});return n.set("attOffset",new Float32Array(e)),{capsule:n,elements:new Uint8Array(i)}}(n),f=e.makeDataset();this.vao=t.createVAO(u,[d,f],m),this.vertexCount=m.length,this.instanceCount=f.count}};let TgdPainterSegmentsData=class TgdPainterSegmentsData{get count(){return this._count}add(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;this.attAxyzr.push(...t),this.attAuv.push(...i),this.attAinfluence.push(n),this.attBxyzr.push(...e),this.attBuv.push(...r),this.attBinfluence.push(s),this._count++}makeDataset(){let t=new r.Y({attAxyzr:"vec4",attAuv:"vec2",attAinfluence:"float",attBxyzr:"vec4",attBuv:"vec2",attBinfluence:"float"},{divisor:1});return t.set("attAxyzr",new Float32Array(this.attAxyzr)),t.set("attAuv",new Float32Array(this.attAuv)),t.set("attAinfluence",new Float32Array(this.attAinfluence)),t.set("attBxyzr",new Float32Array(this.attBxyzr)),t.set("attBuv",new Float32Array(this.attBuv)),t.set("attBinfluence",new Float32Array(this.attBinfluence)),t}constructor(){this._count=0,this.attAxyzr=[],this.attAuv=[],this.attAinfluence=[],this.attBxyzr=[],this.attBuv=[],this.attBinfluence=[]}};i(68009)},49339:function(t,e,i){"use strict";i.d(e,{p:function(){return TgdPainter}});let TgdPainter=class TgdPainter{constructor(){this.active=!0}}},74509:function(t,e,i){"use strict";function clamp(t,e,i){return t<e?e:t>i?i:t}function mix(t,e,i){return(1-i)*t+i*e}i.d(e,{C:function(){return mix},u:function(){return clamp}})},8380:function(t,e,i){"use strict";i.d(e,{D:function(){return CellNodes}});var r=i(35829),n=i(14561);let CellNodes=class CellNodes{getByIndex(t){return this.nodesByIndex.get(t)}forEach(t){this.nodes.forEach(t)}computeDistancesFromSoma(){let{nodes:t}=this,e=new Map,i=new Map;t.forEach(t=>e.set(t.index,t));let r=0;if(t.forEach(t=>{let n=function computeDistanceFromSoma(t,e,i){if(t.parent<0)return 0;if(i.has(t.index))return i.get(t.index);let r=e.get(t.parent);if(!r)return 0;let n=r.x-t.x,s=r.y-t.y,a=r.z-t.z,o=Math.sqrt(n*n+s*s+a*a)+computeDistanceFromSoma(r,e,i);return i.set(t.index,o),o}(t,e,i);t.u=n,r=Math.max(r,n)}),0===r)return 0;let n=1/r;return t.forEach(t=>t.u*=n),r}buildTree(){let{nodes:t}=this;if(0===t.length)throw Error("There are no nodes in this file!");let[e]=t,i=new Map;t.forEach(t=>{let r={node:t,children:[]};if(i.set(t.index,r),-1===t.parent)e=t;else if(t.index===t.parent)console.error("Node #".concat(t.index," has itself has a parent!"));else{let e=i.get(t.parent);e?e.children.push(r):console.error("Node #".concat(t.index," has #").concat(t.parent," as a parent, which is not yet defined!"))}});let r=i.get(e.index);if(!r)throw Error("Impossible error! There must be a bug in CellNodes.buildTree().");return r}constructor(t){this.nodes=t,this.nodesByIndex=new Map;let e=0,i=0;t.forEach(t=>{t.type!==n.d.Soma&&(e+=t.radius,i++),this.nodesByIndex.set(t.index,t)}),this.averageRadius=0===i?0:e/i;let s=new Set;t.forEach(t=>{s.add(t.type),0===t.radius&&(t.radius=this.averageRadius)});let{center:a,bbox:o}=function(t){let[e]=t;if(!e)throw Error("Unable to compute bounding box because the nodes array is empty!");let i=new r.Ui(e.x,e.y,e.z),s=new r.Ui(i),a=new r.Ui(i),o=new r.Ui(i),h=1;for(let{x:l,y:c,z:u,radius:d,index:m,type:f,parent:g}of t){if(m===e.index)continue;let t=new r.Ui(l,c,u);-1===g&&i.from(t),f===n.d.Soma&&(o.add(t),h++),s[0]=Math.min(s[0],t[0]-d),a[0]=Math.max(a[0],t[0]+d),s[1]=Math.min(s[1],t[1]-d),a[1]=Math.max(a[1],t[1]+d),s[2]=Math.min(s[2],t[2]-d),a[2]=Math.max(a[2],t[2]+d)}return o.scale(1/h),s.subtract(o),a.subtract(o),{center:o,bbox:new r.Ui(Math.max(Math.abs(s[0]),Math.abs(a[0])),Math.max(Math.abs(s[1]),Math.abs(a[1])),Math.max(Math.abs(s[2]),Math.abs(a[2])))}}(t);this.center=a,this.bbox=o,this.tree=this.buildTree(),this.nodeTypes=Array.from(s)}}},14561:function(t,e,i){"use strict";var r,n;i.d(e,{d:function(){return r}}),(n=r||(r={}))[n.Soma=1]="Soma",n[n.Axon=2]="Axon",n[n.BasalDendrite=3]="BasalDendrite",n[n.ApicalDendrite=4]="ApicalDendrite",n[n.Unknown=666]="Unknown"},86064:function(t){t.exports={main:"scalebar_main__7tE8e"}},80671:function(t){t.exports={legend:"legend_legend__NpS5a",continue:"legend_continue__B7rB7",colorramp:"legend_colorramp___T8nq"}},43263:function(t){t.exports={main:"swc-viewer_main__Fpy95",gizmo:"swc-viewer_gizmo__VrnMg",scalebar:"swc-viewer_scalebar__DiARD",busy:"swc-viewer_busy__YuDwL","anim-rotate":"swc-viewer_anim-rotate__v2zro",error:"swc-viewer_error___DfSS"}}}]);