(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[462],{86462:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var r=n(85893),o=n(26265),i=n(64121),a=n(67294),s=n(18222),l=n(2212),c=function(e){return e._threeContext.getMorphoFromCollection=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=e;if(!t){var n=Object.keys(this._morphologyMeshCollection);if(!n.length)return;t=n[0]}var r=this._morphologyMeshCollection[t];return r},e.isInterneuron=function(){return!this._threeContext.getMorphoFromCollection().children.find((function(e){var t;return"apical_dendrite"===(null===e||void 0===e||null===(t=e.userData)||void 0===t?void 0:t.typename)}))},e._threeContext.getSomaChildren=function(){return this.getMorphoFromCollection().children.filter((function(e){return"soma"===e.userData.typename}))},e._threeContext.getOrphanedSomaChildren=function(){return this.getMorphoFromCollection().children.filter((function(e){return""===e.name}))[0]},e._threeContext.removeOrphanedSomaChildren=function(){var e=this.getMorphoFromCollection(),t=this.getOrphanedSomaChildren();e.remove(t)},e._threeContext.getTargetPointFromSoma=function(){var e=this.getMorphoFromCollection(),t=e.getTargetPoint();if(!!!e._pointToTarget){var n=e.children[e.children.length-1],r=new l.ZzF;r.expandByObject(n),t=r.getCenter(new l.Pa4)}return t},e._threeContext.getCameraHeightAtMorpho=function(){var e=this.getTargetPointFromSoma();this._camera.updateMatrixWorld();var t=this._camera.position.clone().distanceTo(e),n=this._camera.fov*Math.PI/180;return 2*Math.tan(n/2)*t},e._threeContext.focusOnMorphology=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.getMorphoFromCollection(e),n=1,r=new l.ZzF;r.expandByObject(t);var o=r.getSize(new l.Pa4),i=Math.max(o.x,o.y,o.z),a=i/(2*Math.atan(Math.PI*this._camera.fov/360)),s=a/this._camera.aspect,c=n*Math.max(a,s),h=this._controls.target.clone().sub(this._camera.position).normalize().multiplyScalar(c);this._controls.maxDistance=10*c;var u=this.getTargetPointFromSoma();this._camera.lookAt(u),this._controls.target.copy(u),this._camera.near=c/100,this._camera.far=100*c,this._camera.updateProjectionMatrix(),this._camera.position.copy(this._controls.target).sub(h),this._camera.rotation.set(new l.Pa4),this._controls.update(),this._render()},e},h=n(74047),u=n(52700),d=function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},m=function(e,t){var n=t.apparentFontSize,r=void 0===n?5:n,o=function(e,t){var n=t.fontSize,r=void 0===n?48:n,o=t.font,i=void 0===o?"monospace":o,a=t.align,s=void 0===a?"center":a,l=t.baseline,c=void 0===l?"middle":l,h=t.color,u=void 0===h?"black":h,d=document.createElement("canvas"),m=d.getContext("2d");if(m){m.font="".concat(r,"px ").concat(i);var p=m.measureText(e).width,f=r;return d.width=p,d.height=f,d.style.width=p+"px",d.style.height=f+"px",m.font="".concat(r,"px ").concat(i),m.textAlign=s,m.textBaseline=c,m.fillStyle="transparent",m.fillRect(0,0,m.canvas.width,m.canvas.height),m.fillStyle=u,m.fillText(e,p/2,f/2),d}}(e,t);if(o){var i=new l.xEZ(o);i.magFilter=l.TyD,i.needsUpdate=!0;var a=new l.xeV({map:i}),s=new l.jyi(a),c=new l.Tme;return s.scale.set(o.width/o.height*r,r,1),s.position.set(0,1.5,0),c.add(s),c}console.warn("no canvas found when making text")},p=function(){function e(t){var n=this;(0,h.Z)(this,e),this.div=t,(0,o.Z)(this,"renderer",void 0),(0,o.Z)(this,"scene",void 0),(0,o.Z)(this,"camera",void 0),(0,o.Z)(this,"orientationHelper",void 0),(0,o.Z)(this,"requestedAnimationFrameID",0),(0,o.Z)(this,"followCamera",null);var r=document.createElement("canvas");t.appendChild(r);var i=r.getContext("webgl2",{alpha:!0,antialias:!0});this.renderer=new l.CP7({canvas:r,context:i||void 0}),this.renderer.setClearColor(16777215,0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(t.clientWidth,t.clientHeight),this.scene=new l.xsS,this.camera=new l.cPb(27,t.clientWidth/t.clientHeight,1,5e4);var a=0,s=0,c=100;this.camera.lookAt(new l.Pa4(0,0,0)),this.camera.position.x=a,this.camera.position.y=s,this.camera.position.z=c,this.scene.add(this.camera),this.orientationHelper=function(){for(var e=new l.Tme,t=["red","green","blue"],n=["X","Y","Z"],r=[[15,0,0],[0,0,15],[0,15,0]],o=0;o<=2;o++){var i=t[o],a=new l.Pa4(r[o][0],r[o][1],r[o][2]),s=new l.ZXM;s.vertices.push(a,new l.Pa4(0,0,0));var c=new l.nls({color:i,linewidth:1}),h=new l.ejS(s,c),u=m(n[o],{color:i}),d=a.clone().multiplyScalar(1.2);null===u||void 0===u||u.position.set(d.x,d.y,d.z),u&&e.add(u,h)}return e}(),this.scene.add(this.orientationHelper),window.addEventListener("resize",(function(){var e;null===(e=n.renderer)||void 0===e||e.setSize(t.clientWidth,t.clientHeight)})),this.animate()}return(0,u.Z)(e,[{key:"setFollowCamera",value:function(e){this.followCamera=e}},{key:"animate",value:function(){this.requestedAnimationFrameID=requestAnimationFrame(this.animate.bind(this)),this.render()}},{key:"render",value:function(){var e;this.followCamera&&(null===(e=this.camera)||void 0===e||e.lookAt(this.orientationHelper.position.clone()),this.orientationHelper.rotation.copy(this.followCamera.rotation.clone()),this.orientationHelper.scale.x=-1,this.orientationHelper.scale.y=-1,this.orientationHelper.scale.z=-1);this.scene&&this.camera&&this.renderer&&this.renderer.render(this.scene,this.camera)}},{key:"destroy",value:function(){d(this.div),cancelAnimationFrame(this.requestedAnimationFrameID),this.scene=null,this.renderer=null,this.camera=null}}]),e}(),f=n(87107),v=function(){function e(t,n){(0,h.Z)(this,e),this.div=t,(0,o.Z)(this,"svg",void 0),(0,o.Z)(this,"scale",void 0),(0,o.Z)(this,"axis",void 0);var r=t,i=r.clientWidth,a=r.clientHeight,s=20,l=20,c=[0,n];this.svg=f.Ys(t).append("svg").attr("width",i).attr("height",a),this.scale=f.BYU().range([a-s,l]).domain([f.VV$(c)||0,f.Fp7(c)||n]),this.axis=f.Khx(this.scale),this.svg.append("g").call(this.axis),this.onScaleChange(n)}return(0,u.Z)(e,[{key:"onScaleChange",value:function(e){this.scale.domain([0,e]),this.svg.call(f.Khx(this.scale).tickFormat((function(e){return"".concat(e," \u03bcm")})))}},{key:"destroy",value:function(){this.svg.remove(),d(this.div)}}]),e}(),g=function(e){var t=e.isInterneuron,n=e.hasApproximatedSoma;return(0,r.jsx)("div",{className:"morpho-legend",children:(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{className:"soma",children:["Soma ",n&&"(Approximated)"]}),(0,r.jsx)("li",{className:"axon",children:"Axon"}),t?(0,r.jsx)("li",{className:"basal-dendrites",children:"Dendrites"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("li",{className:"basal-dendrites",children:"Basal Dendrites"}),(0,r.jsx)("li",{className:"apical-dendrites",children:"Apical Dendrites"})]})]})})};function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var y=n(90297).Z,C=n(30323).Z,w=function(e){var t=e.data,n=e.options,s=a.useRef(null),l=a.useRef(null),h=a.useRef(null),u=a.useState(null),d=(0,i.Z)(u,2),m=d[0],f=d[1],w=a.useState(null),_=(0,i.Z)(w,2),j=_[0],O=_[1],S=a.useState(null),b=(0,i.Z)(S,2),P=b[0],M=b[1];a.useEffect((function(){if(m){if(!m.hasSomaData){var e=m._threeContext.getOrphanedSomaChildren();null===e||void 0===e||e.material.color.setHex(0)}m.hasSomaData&&!n.asPolyline&&(m._threeContext.removeOrphanedSomaChildren(),m._threeContext.getSomaChildren().forEach((function(e){null===e||void 0===e||e.material.color.setHex(0)})),m._threeContext._render())}}),[m&&m._threeContext]),a.useEffect((function(){var e;if(s.current){try{var r=new C.SwcParser;r.parse(t);var i=r.getRawMorphology(),a=i.soma.points.length>1;(e=c(new y.MorphoViewer(s.current))).hasSomaData=a,e._threeContext._camera.up.negate(),f(e);var l=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({name:"morphology"},n);e.addMorphology(i,l)}catch(h){throw new Error("Morphology parsing error: ".concat(h.message))}return function(){e&&e.destroy()}}}),[s,t,n]),a.useEffect((function(){if(l.current)return j||O(new p(l.current)),m&&j&&j.setFollowCamera(m._threeContext._camera),function(){null===j||void 0===j||j.destroy(),O(null)}}),[l,m,n]),a.useEffect((function(){var e=null;if(h.current)return P||M(new v(h.current,0)),m&&P&&(P.onScaleChange(m._threeContext.getCameraHeightAtMorpho()),e=function(){P.onScaleChange(m._threeContext.getCameraHeightAtMorpho())},m._threeContext._controls.addEventListener("change",e)),function(){var t,n;null===P||void 0===P||P.destroy(),M(null),null===m||void 0===m||null===(t=m._threeContext)||void 0===t||null===(n=t._controls)||void 0===n||n.removeEventListener("change",e)}}),[h,m,n]);var Z=function(){null===m||void 0===m||m._threeContext._controls.reset(),null===m||void 0===m||m._threeContext._camera.up.negate(),null===m||void 0===m||m._threeContext.focusOnMorphology()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g,{isInterneuron:!(null===m||void 0===m||!m.isInterneuron()),hasApproximatedSoma:!(null!==m&&void 0!==m&&m.hasSomaData)}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"morpho-viewer",ref:s}),(0,r.jsx)("div",{className:"scale",ref:h,onClick:Z}),(0,r.jsx)("div",{className:"orientation",ref:l,onClick:Z})]})]})},_=function(e){var t=e.loading,n=e.error,o=e.data,i=e.options,a=e.onPolylineClick;return(0,r.jsxs)("div",{className:t?"morpho-wrapper loading":"morpho-wrapper",children:[(0,r.jsx)("div",{className:"actions",children:(0,r.jsx)(s.Z,{size:"small",disabled:t,onClick:a,children:i.asPolyline?"Show as Geometry":"Show as Lines"})}),n&&(0,r.jsx)("p",{children:n.message}),o&&!n&&(0,r.jsx)(w,{data:o,options:i})]})};function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S=function(e){var t=e.path,n=a.useState({loading:!0,error:null,data:null}),o=(0,i.Z)(n,2),s=o[0],l=s.loading,c=s.error,h=s.data,u=o[1],d=a.useState({asPolyline:!0,focusOn:!0,somaMode:"fromOrphanSections"}),m=(0,i.Z)(d,2),p=m[0],f=m[1];a.useEffect((function(){fetch(t).then((function(e){return e.text()})).then((function(e){return u({data:e,error:null,loading:!1})})).catch((function(e){return u({error:e,data:null,loading:!1})}))}),[t]);return(0,r.jsx)(_,O({},{loading:l,error:c,data:h,options:p,onPolylineClick:function(){f(O(O({},p),{},{asPolyline:!p.asPolyline}))}}))}}}]);
//# sourceMappingURL=462.69f782ccb4c33c624019.js.map