!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="82c59571-3db3-40f4-8230-3369d5f1ec1e",e._sentryDebugIdIdentifier="sentry-dbid-82c59571-3db3-40f4-8230-3369d5f1ec1e")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6935],{58856:function(e,t,r){"use strict";var n=r(85893),o=r(67294),a=r(23148),c=r(26495),i=r(61267);a.kL.register(a.f$,a.ZL,a.Dx,a.u,a.De),t.Z=e=>{var t,r;let{plotData:a,xAxis:l="Value",yAxis:s="Frequency",xAxisTickStep:u=1,MeanStd:d}=e,[f,S]=(0,o.useState)(0);(0,o.useEffect)(()=>{{S(window.innerWidth);let handleResize=()=>{S(window.innerWidth)};return window.addEventListener("resize",handleResize),()=>{window.removeEventListener("resize",handleResize)}}},[]);let formatScientificNotation=e=>{if(1e3>Math.abs(e))return e.toString();if(0===e)return"0";let t=Math.floor(Math.log10(Math.abs(e))),r=e/Math.pow(10,t),n=["⁰","\xb9","\xb2","\xb3","⁴","⁵","⁶","⁷","⁸","⁹"],o=Math.abs(t).toString().split("").map(e=>n[parseInt(e)]).join("");return"".concat(Math.round(100*r)/100,"*10").concat(t<0?"⁻":"").concat(o)},{dataPoints:p,units:h,name:y,description:_}=(0,o.useMemo)(()=>{if(!a)return{dataPoints:[],units:null,name:"",description:""};let createHistogram=e=>{let t=Math.min(20,e.length),r=Math.min(...e),n=(Math.max(...e)-r)/t,o=Array.from({length:t+1},(e,t)=>r+t*n),a=Array(t).fill(0);e.forEach(e=>{let o=Math.min(Math.floor((e-r)/n),t-1);a[o]++});let c=a.map((e,t)=>({x:o[t],y:e}));return{dataPoints:c}};if(Array.isArray(a)){let{dataPoints:e}=createHistogram(a);return{dataPoints:e,units:null,name:"",description:""}}if("object"!=typeof a||null===a)return console.error("Unexpected data format",a),{dataPoints:[],units:null,name:"",description:""};if("freq"in a&&"bins"in a){let e=a.bins.map((e,t)=>({x:e,y:a.freq[t]}));return{dataPoints:e,units:a.units,name:a.name||"",description:a.description||""}}if("bins"in a&&"counts"in a){let e=a.bins.map((e,t)=>({x:e,y:a.counts[t]}));return{dataPoints:e,units:null,name:"",description:""}}if("values"in a&&Array.isArray(a.values)){let e=a.values.flat(),{dataPoints:t}=createHistogram(e);return{dataPoints:t,units:null,name:"",description:""}}{let e=Object.entries(a).map(e=>{let[t,r]=e;return{x:parseFloat(t),y:r}});return{dataPoints:e,units:null,name:"",description:""}}},[a]),m=(0,o.useMemo)(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{title:e=>{let t=e[0].dataIndex,r=e[0].parsed.x,n=p[t+1]?p[t+1].x:r;return"".concat(r," - ").concat(n," ").concat(h||"")}}}},scales:{x:{type:"linear",title:{display:!0,text:l},ticks:{stepSize:u,maxRotation:0,minRotation:0,callback:function(e){return e.toString()}}},y:{title:{display:!0,text:s},ticks:{callback:function(e){return formatScientificNotation(Number(e))}}}}}),[u,l,s,p,h]);if(0===p.length)return(0,n.jsx)("div",{children:"No data available for the plot."});let v={datasets:[{label:"Frequency",data:p,backgroundColor:i.x8.blue,borderWidth:0,barPercentage:.9,categoryPercentage:.9}]};return(0,n.jsxs)("div",{children:[d&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("p",{children:["Mean: ",null==d?void 0:null===(t=d.mean)||void 0===t?void 0:t.toFixed(4)]}),(0,n.jsxs)("p",{children:["Standard Deviation: ",null==d?void 0:null===(r=d.std)||void 0===r?void 0:r.toFixed(4)]})]}),y&&(0,n.jsx)("h2",{children:y}),_&&(0,n.jsx)("p",{children:_}),(0,n.jsx)("div",{style:{width:"100%",height:"400px"},children:(0,n.jsx)(c.$Q,{data:v,options:m})})]})}},82718:function(e,t,r){"use strict";var n=r(85893);r(67294);var o=r(93967),a=r.n(o),c=r(51763),i=r.n(c);t.Z=e=>{let{centered:t,children:r}=e;return(0,n.jsx)("div",{className:i().flexWrapper,children:(0,n.jsx)("div",{className:a()(i().container,t?i()["container--centered"]:""),children:r})})}},22633:function(e,t,r){"use strict";var n=r(85893),o=r(67294),a=r(99477),c=r(87011),i=r(97157),l=r(71711),s=r(61267),u=r(17931),d=r(80204),f=r.n(d);t.Z=e=>{let{value:t="region",onSelect:r=()=>{},theme:d=2}=e,S=(0,o.useRef)(null),p=(0,o.useRef)(null),h=(0,o.useRef)(t),y=(0,o.useRef)(null),_=(0,o.useRef)(null),m=(0,o.useRef)(null),v=(0,o.useRef)(null),P=(0,o.useRef)(null),g=(0,o.useRef)(new a.FM8),b=(0,o.useRef)(null),w=(0,o.useRef)(null),C=(0,o.useRef)(null),x=(0,o.useRef)(!1),[O,B]=(0,o.useState)(21),[M,j]=(0,o.useState)(1),A=(0,o.useCallback)(e=>{if(!x.current)return;let t=S.current.getBoundingClientRect();g.current.x=(e.clientX-t.left)/t.width*2-1,g.current.y=-(2*((e.clientY-t.top)/t.height))+1,P.current.setFromCamera(g.current,_.current);let n=P.current.intersectObjects([b.current,w.current,C.current],!0);if(n.length>0){let e=n[0].object;for(;e.parent&&![b.current,w.current,C.current].includes(e);)e=e.parent;if([b.current,w.current,C.current].includes(e)){let t=e.userData.volumeSection;t&&(updateSelection(t,e),r(t))}}},[r,d]),updateSelection=(e,t)=>{y.current&&updateObjectColors(y.current,s.rS[d].default,s.rS[d].hover),updateObjectColors(t,s.rS[d].selected,16777215),h.current=e,y.current=t},updateObjectColors=(e,t,r)=>{e.traverse(n=>{n instanceof a.Kj0&&(n.name===e.userData.volumeSection&&n.material.color.set(t),n.geometry&&"TextGeometry"===n.geometry.type&&n.material.color.set(r))})};(0,o.useEffect)(()=>{if(!S.current)return;m.current=new a.xsS,m.current.background=new a.Ilk("#313354");let e=S.current.clientWidth/S.current.clientHeight;_.current=new a.iKG(-(200*e),200*e,200,-200,.1,1e3),_.current.position.z=10,v.current=new a.CP7({antialias:!0,alpha:!0}),v.current.setSize(S.current.clientWidth,S.current.clientHeight),v.current.setPixelRatio(window.devicePixelRatio),S.current.appendChild(v.current.domElement),P.current=new a.iMs;let r=new c.L;r.load("".concat(u.$N,"/3d/volume-selector/volume-selector.obj"),e=>{[b,w,C].forEach((t,r)=>{let n=e.clone();t.current=n,n.position.set((r-1)*O,0,0),n.userData.volumeSection=["region","slice","cylinder"][r],applyMaterial(n,r),m.current.add(n)});let r=new i.J;r.load("".concat(u.sb,"/assets/fonts/Titillium_Web_Light_.json"),e=>{["Region","Slice","Cylinder"].forEach((t,r)=>{createText(t,[b,w,C][r].current,t.toLowerCase(),e)})}),x.current=!0,t&&setInitialSelection(t),animate()},e=>console.log(e.loaded/e.total*100+"% loaded"),e=>console.error("An error happened",e));let animate=()=>{requestAnimationFrame(animate),v.current.render(m.current,_.current)},handleResize=()=>{if(S.current&&v.current&&_.current){let e=S.current.clientWidth,t=S.current.clientHeight;v.current.setSize(e,t);let r=e/t;_.current.left=-(200*r),_.current.right=200*r,_.current.top=200,_.current.bottom=-200,_.current.updateProjectionMatrix();let n=window.innerWidth<1400?16:21;B(n),_.current.zoom=window.innerWidth<1200?11:16,_.current.updateProjectionMatrix();let o=window.innerWidth<1200?1:.8;j(o),updateTextSize()}},handleMouseMove=e=>{if(!x.current)return;let t=S.current.getBoundingClientRect();g.current.x=(e.clientX-t.left)/t.width*2-1,g.current.y=-(2*((e.clientY-t.top)/t.height))+1,P.current.setFromCamera(g.current,_.current);let r=P.current.intersectObjects([b.current,w.current,C.current],!0);if(r.length>0){let e=r[0].object;for(;e.parent&&![b.current,w.current,C.current].includes(e);)e=e.parent;p.current!==e&&y.current!==e&&(p.current&&p.current!==y.current&&updateObjectColors(p.current,s.rS[d].default,s.rS[d].hover),updateObjectColors(e,s.rS[d].hover,s.rS[d].hover),p.current=e,S.current.style.cursor="pointer")}else p.current&&p.current!==y.current&&(updateObjectColors(p.current,s.rS[d].default,s.rS[d].hover),p.current=null,S.current.style.cursor="default")};return window.addEventListener("resize",handleResize),S.current.addEventListener("mousemove",handleMouseMove),S.current.addEventListener("click",A),handleResize(),()=>{window.removeEventListener("resize",handleResize),S.current&&(S.current.removeEventListener("mousemove",handleMouseMove),S.current.removeEventListener("click",A),S.current.removeChild(v.current.domElement))}},[d]),(0,o.useEffect)(()=>{x.current&&[b,w,C].forEach((e,t)=>{e.current&&e.current.position.set((t-1)*O,0,0)})},[O]),(0,o.useEffect)(()=>{x.current&&t&&setInitialSelection(t)},[t,d]);let applyMaterial=(e,t)=>{e.traverse(t=>{if(t instanceof a.Kj0){let r;if(t.name===e.userData.volumeSection)r=new a.vBJ({color:s.rS[d].default,transparent:!1,opacity:1,depthWrite:!0}),t.renderOrder=2;else if("skeleton"===t.name){r=new a.vBJ({color:s.rS[d].selectedEdges,transparent:!0,opacity:0,depthWrite:!1});let e=new a.TOt(t.geometry),n=new a.nls({color:s.rS[d].default,transparent:!0,opacity:1,depthWrite:!1}),o=new a.ejS(e,n);o.renderOrder=1,t.add(o)}else t.visible=!1;r&&(t.material=r)}})},createText=(e,t,r,n)=>{let o=new l.M(e,{font:n,size:M,height:.2,curveSegments:32,bevelEnabled:!0,bevelThickness:.02,bevelSize:.02}),c=h.current===r?16777215:s.rS[d].hover,i=new a.vBJ({color:c,transparent:!1,opacity:1}),u=new a.Kj0(o,i);t.traverse(e=>{e instanceof a.Kj0&&e.name===r&&(u.position.set(0,0,0),e.add(u))})},updateTextSize=()=>{["Region","Slice","Cylinder"].forEach((e,t)=>{let r=[b,w,C][t].current;r&&r.traverse(t=>{if(t instanceof a.Kj0&&t.geometry&&"TextGeometry"===t.geometry.type){let n=t.parent;if(n){n.remove(t);let o=new i.J;o.load("".concat(u.sb,"/assets/fonts/Titillium_Web_Light_.json"),t=>{createText(e,r,e.toLowerCase(),t)})}}})})},setInitialSelection=e=>{let t=[b,w,C].find(t=>{var r;return(null===(r=t.current)||void 0===r?void 0:r.userData.volumeSection)===e});(null==t?void 0:t.current)&&updateSelection(e,t.current)};return(0,n.jsxs)("div",{className:f().container,children:[(0,n.jsx)("div",{className:f().volumeSelector,ref:S}),(0,n.jsx)("div",{className:f().volumeList})]})}},74660:function(e,t,r){"use strict";r.d(t,{T:function(){return DualNeuronWithSynapsesView}});var n=r(85893);r(67294);var o=r(42978),a=r(29227);function isObject(e){return!(!e||Array.isArray(e))&&"object"==typeof e}async function fetchDualNeuron(e){let t=await fetch(e);if(!t.ok)throw Error('Unable to load from "'.concat(e,'": error #').concat(t.status," ").concat(t.statusText));let r=await t.arrayBuffer(),n=(0,a.Jx)(r);return function(e){let t={etype:"string",layer:"string",me_combo:"string",morph_class:"string",morphology:"string",mtype:"string",region:"string",synapse_class:"string",x:"number",y:"number",z:"number",orientation:["array(3)",["array(3)","number"]],morph:["array",["array","number"]]};(function assertType(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"data";if("unknown"!==t){if("null"===t){if(null!==e)throw Error("Expected ".concat(r," to be null and not a ").concat(typeof e,"!"));return}if("string"==typeof t){if(typeof e!==t)throw Error("Expected ".concat(r," to be a ").concat(t," and not a ").concat(typeof e,"!"));return}if(Array.isArray(t)){let[n]=t;switch(n){case"array":(function(e,t,r){if(!Array.isArray(e))throw Error("Expected ".concat(t," to be an array and not a ").concat(typeof e,"!"));let[,n]=r;for(let r=0;r<e.length;r+=1)assertType(e[r],n,"".concat(t,"[").concat(r,"]"))})(e,r,t);return;case"map":(function(e,t,r){if(!isObject(e))throw Error("Expected ".concat(t," to be an object and not a ").concat(typeof e,"!"));let[,n]=r;for(let r of Object.keys(e))"string"==typeof r&&assertType(e[r],n,"".concat(t,"[").concat(r,"]"))})(e,r,t);return;case"?":(function(e,t,r){if(void 0===e)return;let[,n]=r;assertType(e,n,t)})(e,r,t);return;case"|":(function(e,t,r){let[,...n]=r,o=Error("No type has been defined for this alternative: ".concat(JSON.stringify(r),"!"));for(let r of n)try{assertType(e,r,t);return}catch(e){e instanceof Error&&(o=e)}throw o})(e,r,t);return;case"tuple":(function(e,t,r){let[,...n]=r;if(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";if(!Array.isArray(e))throw Error("".concat(t," was expected to be an Array but we got ").concat(typeof e,"!"))}(e),n.length!==e.length)throw Error("Expected ".concat(t," to have ").concat(n.length," elements, not ").concat(e.length,"!"));for(let r=0;r<n.length;r++){let o=n[r];assertType(e[r],o,"".concat(t,"[$i]"))}})(e,r,t);return;case"partial":(function(e,t,r){let[,n]=r;for(let r of(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";if(!isObject(e))throw Error("".concat(t," was expected to be an object but we got ").concat(typeof e,"!"))}(e,t),Object.keys(n))){if("string"!=typeof r)continue;let o=e[r];void 0!==o&&assertType(o,n[r],"".concat(t,".").concat(r))}})(e,r,t);return;case"literal":(function(e,t,r){let[,...n]=r;for(let t of n)if(e===t)return;throw Error("Expected ".concat(t," to be a literal (").concat(n.map(e=>'"'.concat(e,'"')).join(" | "),")!"))})(e,r,t);return;default:if(n.startsWith("array(")){let o=parseInt(n.substring(6,n.length-1),10);(function(e,t,r,n){if(!Array.isArray(e))throw Error("Expected ".concat(t," to be an array and not a ").concat(typeof e,"!"));if(e.length!==n)throw Error("".concat(t," was expected to have a length of ").concat(n,", but we got ").concat(e.length,"!"));let[,o]=r;for(let r=0;r<e.length;r+=1)assertType(e[r],o,"".concat(t,"[").concat(r,"]"))})(e,r,t,o);return}throw Error("Don't know how to create a type guard for this kind of type: ".concat(JSON.stringify(t)))}}if("object"!=typeof e)throw Error("Expected ".concat(r," to be an object and not a ").concat(typeof e,"!"));for(let n of Object.keys(t))"string"==typeof n&&assertType(e[n],t[n],"".concat(r,".").concat(n))}})(e,{pre:t,post:t,synapses:["array",["array","number"]]})}(n),{pre:convertToNeuronData(n.pre),post:convertToNeuronData(n.post),synapses:n.synapses.map(convertToSynapseData)}}function convertToNeuronData(e){return{etype:e.etype,layer:e.layer,meCombo:e.me_combo,morphClass:e.morph_class,morphology:e.morphology,mtype:e.mtype,region:e.region,synapseClass:e.synapse_class,x:e.x,y:e.y,z:e.z,orientation:structuredClone(e.orientation),morph:e.morph.map(convertToNeuronSectionData)}}function convertToSynapseData(e){let[t,r,n,o,a,c,i,l]=e;return{x:t,y:r,z:n,type:o,preSectionId:a,postSectionId:c,preGID:i,postGID:l}}let c=["soma","axon","dend"];function convertToNeuronSectionData(e){var t;let[r,n,...o]=e,a=[];for(let e=0;e<o.length;e+=4)a.push({x:o[e+0],y:o[e+1],z:o[e+2],r:o[e+3]/2});return{sectionType:null!==(t=c[r])&&void 0!==t?t:"dend",isBase:0!==n,points:a}}var i=r(96259),l=r.n(i),s=r(17931),u=r(32071),d=r(8380),f=r(14561);function DualNeuronWithSynapsesView(e){let{className:t,pre:r,post:a}=e,c=function(e,t){var r,n;e=null!==(r=S[e])&&void 0!==r?r:e,t=null!==(n=S[t])&&void 0!==n?n:t;let o=!1,a="".concat(e,"/").concat(t);if(!p.has(a)){let r="".concat(t,"/").concat(e);if(!p.has(r))return null;let n=e;e=t,t=n,o=!0}return{reverse:o,href:"data/3d/3_digital-reconstruction/connection-viewer/".concat(e,"-").concat(t,".msgpack")}}(r,a);return c?(0,n.jsx)(u.f,{className:(0,o.AK)(l().main,t),href:c.href,loader:c.reverse?loadMsgPackReversed:loadMsgPack,legend:[{label:"Pre",color:"#07f"},{label:"Post",color:"#f70"},{label:"Synapse",color:"#ff0"}]}):(0,n.jsx)("div",{className:"text-center p-4",children:(0,n.jsx)("p",{className:"text-red-500",children:"No synapse view available for this selection."})})}let loadMsgPackReversed=async e=>{let t=await loadMsgPack(e);return t.morphologies[0].colors=["#333","#a40","#f70"],t.morphologies[1].colors=["#333","#04a","#07f"],t},loadMsgPack=async e=>{try{let t=await fetchDualNeuron("".concat(s.sb,"/").concat(e)),r=convertDualNeuronIntoCellNodes(t.pre),n=convertDualNeuronIntoCellNodes(t.post),o=10*Math.max(r.averageRadius,n.averageRadius);return{morphologies:[{colors:["#333","#04a","#07f"],nodes:r},{colors:["#333","#a40","#f70"],nodes:n},{colors:["#ff0"],nodes:function(e,t){let r=[];for(let n of e){let{x:e,y:o,z:a}=n;r.push({index:r.length,parent:-1,type:f.d.Unknown,radius:t,x:e,y:o,z:a,u:0,v:0}),r.push({index:r.length,parent:r.length-1,type:f.d.Unknown,radius:t,x:e,y:o,z:a,u:0,v:0})}return new d.D(r)}(t.synapses,o),minRadius:8,roundness:24}]}}catch(e){throw e}};function convertDualNeuronIntoCellNodes(e){let t=[],r=new Set;for(let n of e.morph){let e=-1;for(let o=0;o<n.points.length;o++){let a=n.points[o],c=t.length,i=function(e){switch(e){case"soma":return f.d.Soma;case"axon":return f.d.Axon;case"dend":return f.d.BasalDendrite;default:return f.d.Unknown}}(n.sectionType),l=(i-.5)/3;r.add(l),t.push({index:c,parent:e,type:i,radius:a.r,x:a.x,y:a.y,z:a.z,u:l,v:l}),e=c}}return new d.D(t)}let S={Excitatory:"SP_PC",Inhibitory:"SP_PVBC",All:"SLM_PPA"},p=new Set(["SLM_PPA/SO_OLM","SLM_PPA/SO_Tri","SLM_PPA/SP_CCKBC","SLM_PPA/SR_SCA","SO_BP/SLM_PPA","SO_BP/SO_OLM","SO_BP/SO_Tri","SO_BP/SP_CCKBC","SO_BP/SR_SCA","SO_BS/SLM_PPA","SO_BS/SO_BP","SO_BS/SO_OLM","SO_BS/SO_Tri","SO_BS/SP_AA","SO_BS/SP_BS","SO_BS/SP_CCKBC","SO_BS/SP_Ivy","SO_BS/SP_PC","SO_BS/SP_PVBC","SO_BS/SR_SCA","SO_OLM/SR_SCA","SO_Tri/SO_OLM","SO_Tri/SP_CCKBC","SO_Tri/SR_SCA","SP_AA/SP_PC","SP_BS/SLM_PPA","SP_BS/SO_BP","SP_BS/SO_OLM","SP_BS/SO_Tri","SP_BS/SP_CCKBC","SP_BS/SP_Ivy","SP_BS/SR_SCA","SP_CCKBC/SO_OLM","SP_CCKBC/SR_SCA","SP_Ivy/SLM_PPA","SP_Ivy/SO_BP","SP_Ivy/SO_OLM","SP_Ivy/SO_Tri","SP_Ivy/SP_CCKBC","SP_Ivy/SR_SCA","SP_PC/SLM_PPA","SP_PC/SO_BP","SP_PC/SO_OLM","SP_PC/SO_Tri","SP_PC/SP_BS","SP_PC/SP_CCKBC","SP_PC/SP_Ivy","SP_PC/SP_PVBC","SP_PC/SR_SCA","SP_PVBC/SLM_PPA","SP_PVBC/SO_BP","SP_PVBC/SO_OLM","SP_PVBC/SO_Tri","SP_PVBC/SP_BS","SP_PVBC/SP_CCKBC","SP_PVBC/SP_Ivy","SP_PVBC/SR_SCA"])},96259:function(e){e.exports={main:"dual-neuron-with-synapses-view_main__KQFQ6"}},51763:function(e){e.exports={container:"styles_container__31D34","container--center":"styles_container--center__Yuntq",flexWrapper:"styles_flexWrapper___gDLe"}},80204:function(e){e.exports={container:"styles_container__NKkJz",volumeSelector:"styles_volumeSelector__dN4Dl",volumeList:"styles_volumeList__5Src0",volumeSection:"styles_volumeSection__yJuJz",active:"styles_active__RrlYY"}}}]);
//# sourceMappingURL=6935-4786046b0294605f.js.map