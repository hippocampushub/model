"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[269],{9269:function(e,t,n){n.r(t),n.d(t,{default:function(){return S}});var r=n(5893),o=n(7294),a=n(9707),i=n(2212),l=function(e){return e._threeContext.getMorphoFromCollection=function(e){var t=void 0===e?null:e;if(!t){var n=Object.keys(this._morphologyMeshCollection);if(!n.length)return;t=n[0]}return this._morphologyMeshCollection[t]},e.isInterneuron=function(){return!this._threeContext.getMorphoFromCollection().children.find((function(e){var t;return"apical_dendrite"===(null===e||void 0===e||null===(t=e.userData)||void 0===t?void 0:t.typename)}))},e._threeContext.getSomaChildren=function(){return this.getMorphoFromCollection().children.filter((function(e){return"soma"===e.userData.typename}))},e._threeContext.getOrphanedSomaChildren=function(){return this.getMorphoFromCollection().children.filter((function(e){return""===e.name}))[0]},e._threeContext.removeOrphanedSomaChildren=function(){var e=this.getMorphoFromCollection(),t=this.getOrphanedSomaChildren();e.remove(t)},e._threeContext.getTargetPointFromSoma=function(){var e=this.getMorphoFromCollection(),t=e.getTargetPoint();if(!!!e._pointToTarget){var n=e.children[e.children.length-1],r=new i.ZzF;r.expandByObject(n),t=r.getCenter(new i.Pa4)}return t},e._threeContext.getCameraHeightAtMorpho=function(){var e=this.getTargetPointFromSoma();this._camera.updateMatrixWorld();var t=this._camera.position.clone().distanceTo(e),n=this._camera.fov*Math.PI/180;return 2*Math.tan(n/2)*t},e._threeContext.focusOnMorphology=function(e){var t=void 0===e?null:e,n=this.getMorphoFromCollection(t),r=new i.ZzF;r.expandByObject(n);var o=r.getSize(new i.Pa4),a=Math.max(o.x,o.y,o.z)/(2*Math.atan(Math.PI*this._camera.fov/360)),l=a/this._camera.aspect,s=1*Math.max(a,l),c=this._controls.target.clone().sub(this._camera.position).normalize().multiplyScalar(s);this._controls.maxDistance=10*s;var h=this.getTargetPointFromSoma();this._camera.lookAt(h),this._controls.target.copy(h),this._camera.near=s/100,this._camera.far=100*s,this._camera.updateProjectionMatrix(),this._camera.position.copy(this._controls.target).sub(c),this._camera.rotation.set(new i.Pa4),this._controls.update(),this._render()},e},s=function(e){for(;e.lastChild;)e.removeChild(e.lastChild)},c=function(e,t){var n=t.apparentFontSize,r=void 0===n?5:n,o=function(e,t){var n=t.fontSize,r=void 0===n?48:n,o=t.font,a=void 0===o?"monospace":o,i=t.align,l=void 0===i?"center":i,s=t.baseline,c=void 0===s?"middle":s,h=t.color,u=void 0===h?"black":h,d=document.createElement("canvas"),f=d.getContext("2d");if(f){f.font="".concat(r,"px ").concat(a);var m=f.measureText(e).width,v=r;return d.width=m,d.height=v,d.style.width=m+"px",d.style.height=v+"px",f.font="".concat(r,"px ").concat(a),f.textAlign=l,f.textBaseline=c,f.fillStyle="transparent",f.fillRect(0,0,f.canvas.width,f.canvas.height),f.fillStyle=u,f.fillText(e,m/2,v/2),d}}(e,t);if(o){var a=new i.xEZ(o);a.magFilter=i.TyD,a.needsUpdate=!0;var l=new i.xeV({map:a}),s=new i.jyi(l),c=new i.Tme;return s.scale.set(o.width/o.height*r,r,1),s.position.set(0,1.5,0),c.add(s),c}console.warn("no canvas found when making text")};function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.div=t,this.requestedAnimationFrameID=0,this.followCamera=null;var r=document.createElement("canvas");t.appendChild(r);var o=r.getContext("webgl2",{alpha:!0,antialias:!0});this.renderer=new i.CP7({canvas:r,context:o||void 0}),this.renderer.setClearColor(16777215,0),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(t.clientWidth,t.clientHeight),this.scene=new i.xsS,this.camera=new i.cPb(27,t.clientWidth/t.clientHeight,1,5e4);var a=0,l=0,s=100;this.camera.lookAt(new i.Pa4(0,0,0)),this.camera.position.x=a,this.camera.position.y=l,this.camera.position.z=s,this.scene.add(this.camera),this.orientationHelper=function(){for(var e=new i.Tme,t=["red","green","blue"],n=["X","Y","Z"],r=[[15,0,0],[0,0,15],[0,15,0]],o=0;o<=2;o++){var a=t[o],l=new i.Pa4(r[o][0],r[o][1],r[o][2]),s=new i.ZXM;s.vertices.push(l,new i.Pa4(0,0,0));var h=new i.nls({color:a,linewidth:1}),u=new i.ejS(s,h),d=c(n[o],{color:a}),f=l.clone().multiplyScalar(1.2);null===d||void 0===d||d.position.set(f.x,f.y,f.z),d&&e.add(d,u)}return e}(),this.scene.add(this.orientationHelper),window.addEventListener("resize",(function(){var e;null===(e=n.renderer)||void 0===e||e.setSize(t.clientWidth,t.clientHeight)})),this.animate()}var t,n,r;return t=e,(n=[{key:"setFollowCamera",value:function(e){this.followCamera=e}},{key:"animate",value:function(){this.requestedAnimationFrameID=requestAnimationFrame(this.animate.bind(this)),this.render()}},{key:"render",value:function(){var e;this.followCamera&&(null===(e=this.camera)||void 0===e||e.lookAt(this.orientationHelper.position.clone()),this.orientationHelper.rotation.copy(this.followCamera.rotation.clone()),this.orientationHelper.scale.x=-1,this.orientationHelper.scale.y=-1,this.orientationHelper.scale.z=-1),this.scene&&this.camera&&this.renderer&&this.renderer.render(this.scene,this.camera)}},{key:"destroy",value:function(){s(this.div),cancelAnimationFrame(this.requestedAnimationFrameID),this.scene=null,this.renderer=null,this.camera=null}}])&&h(t.prototype,n),r&&h(t,r),e}(),d=n(9157);function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.div=t;var r=t.clientWidth,o=t.clientHeight,a=20,i=20,l=[0,n];this.svg=d.Ys(t).append("svg").attr("width",r).attr("height",o),this.scale=d.BYU().range([o-a,i]).domain([d.VV$(l)||0,d.Fp7(l)||n]),this.axis=d.Khx(this.scale),this.svg.append("g").call(this.axis),this.onScaleChange(n)}var t,n,r;return t=e,(n=[{key:"onScaleChange",value:function(e){this.scale.domain([0,e]),this.svg.call(d.Khx(this.scale).tickFormat((function(e){return"".concat(e," \u03bcm")})))}},{key:"destroy",value:function(){this.svg.remove(),s(this.div)}}])&&f(t.prototype,n),r&&f(t,r),e}(),v=function(e){var t=e.isInterneuron,n=e.hasApproximatedSoma;return(0,r.jsx)("div",{className:"morpho-legend",children:(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{className:"soma",children:["Soma ",n&&"(Approximated)"]}),(0,r.jsx)("li",{className:"axon",children:"Axon"}),t?(0,r.jsx)("li",{className:"basal-dendrites",children:"Dendrites"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("li",{className:"basal-dendrites",children:"Basal Dendrites"}),(0,r.jsx)("li",{className:"apical-dendrites",children:"Apical Dendrites"})]})]})})};function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(s){o=!0,a=s}finally{try{r||null==l.return||l.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var y=n(760).Z,x=n(323).Z,w=function(e){var t=e.data,n=e.options,a=o.useRef(null),i=o.useRef(null),s=o.useRef(null),c=g(o.useState(null),2),h=c[0],d=c[1],f=g(o.useState(null),2),w=f[0],C=f[1],_=g(o.useState(null),2),b=_[0],S=_[1];o.useEffect((function(){if(h){var e;if(!h.hasSomaData)null===(e=h._threeContext.getOrphanedSomaChildren())||void 0===e||e.material.color.setHex(0);h.hasSomaData&&!n.asPolyline&&(h._threeContext.removeOrphanedSomaChildren(),h._threeContext.getSomaChildren().forEach((function(e){null===e||void 0===e||e.material.color.setHex(0)})),h._threeContext._render())}}),[h&&h._threeContext]),o.useEffect((function(){var e;if(a.current){try{var r=new x.SwcParser;r.parse(t);var o=r.getRawMorphology(),i=o.soma.points.length>1;(e=l(new y.MorphoViewer(a.current))).hasSomaData=i,e._threeContext._camera.up.negate(),d(e);var s=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){p(e,t,n[t])}))}return e}({name:"morphology"},n);e.addMorphology(o,s)}catch(c){throw new Error("Morphology parsing error: ".concat(c.message))}return function(){e&&e.destroy()}}}),[a,t,n]),o.useEffect((function(){if(i.current)return w||C(new u(i.current)),h&&w&&w.setFollowCamera(h._threeContext._camera),function(){null===w||void 0===w||w.destroy(),C(null)}}),[i,h,n]),o.useEffect((function(){var e=null;if(s.current)return b||S(new m(s.current,0)),h&&b&&(b.onScaleChange(h._threeContext.getCameraHeightAtMorpho()),e=function(){b.onScaleChange(h._threeContext.getCameraHeightAtMorpho())},h._threeContext._controls.addEventListener("change",e)),function(){var t,n;null===b||void 0===b||b.destroy(),S(null),null===h||void 0===h||null===(t=h._threeContext)||void 0===t||null===(n=t._controls)||void 0===n||n.removeEventListener("change",e)}}),[s,h,n]);var j=function(){null===h||void 0===h||h._threeContext._controls.reset(),null===h||void 0===h||h._threeContext._camera.up.negate(),null===h||void 0===h||h._threeContext.focusOnMorphology()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v,{isInterneuron:!!(null===h||void 0===h?void 0:h.isInterneuron()),hasApproximatedSoma:!(null===h||void 0===h?void 0:h.hasSomaData)}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"morpho-viewer",ref:a}),(0,r.jsx)("div",{className:"scale",ref:s,onClick:j}),(0,r.jsx)("div",{className:"orientation",ref:i,onClick:j})]})]})},C=function(e){var t=e.loading,n=e.error,o=e.data,i=e.options,l=e.onPolylineClick;return(0,r.jsxs)("div",{className:t?"morpho-wrapper loading":"morpho-wrapper",children:[(0,r.jsx)("div",{className:"actions",children:(0,r.jsx)(a.Z,{size:"small",disabled:t,onClick:l,children:i.asPolyline?"Show as Geometry":"Show as Lines"})}),n&&(0,r.jsx)("p",{children:n.message}),o&&!n&&(0,r.jsx)(w,{data:o,options:i})]})};function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,l=e[Symbol.iterator]();!(r=(i=l.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(s){o=!0,a=s}finally{try{r||null==l.return||l.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var S=function(e){var t=e.path,n=b(o.useState({loading:!0,error:null,data:null}),2),a=n[0],i=a.loading,l=a.error,s=a.data,c=n[1],h=b(o.useState({asPolyline:!0,focusOn:!0,somaMode:"fromOrphanSections"}),2),u=h[0],d=h[1];o.useEffect((function(){fetch(t).then((function(e){return e.text()})).then((function(e){return c({data:e,error:null,loading:!1})})).catch((function(e){return c({error:e,data:null,loading:!1})}))}),[t]);return(0,r.jsx)(C,{loading:i,error:l,data:s,options:u,onPolylineClick:function(){d(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){_(e,t,n[t])}))}return e}({},u,{asPolyline:!u.asPolyline}))}})}}}]);
//# sourceMappingURL=269.2815d651b7bd24b4.js.map