!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="abe28432-4da6-4ce0-aa65-1b63496a6d8e",e._sentryDebugIdIdentifier="sentry-dbid-abe28432-4da6-4ce0-aa65-1b63496a6d8e")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7605],{17388:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reconstruction-data/volume",function(){return n(37111)}])},37111:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return VolumePage}});var r=n(85893),o=n(9008),a=n.n(o),i=n(67294),s=n(89552),l=n(11163),c=n(41664),d=n.n(c),u=n(5152),m=n.n(u),h=n(2064),p=n.n(h);let f=m()(()=>Promise.all([n.e(9006),n.e(3825),n.e(4420)]).then(n.bind(n,54420)),{loadableGenerated:{webpack:()=>[54420]},ssr:!1});var volume_viewer=e=>(0,r.jsx)("div",{className:p().fixedAspectRation,children:(0,r.jsx)(f,{...e})}),v=n(20745),x=n(2801),w=n(83848),g=n(73265),y=n(26401),_=n(65400),j=n(94055),b=n(93162),S=n(99477),C=n(62249),N=n.n(C);let AtomicState=class AtomicState{get value(){return this.currentValue}set value(e){let{transform:t,storage:n}=this.options;t&&(e=t(e)),e!==this.currentValue&&(this.currentValue=e,n?window.localStorage.setItem(this.id,JSON.stringify(e)):this.saveSession(e),this.listeners.forEach(t=>t(e)))}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}loadFromStorage(){let{storage:e}=this.options;if(e)try{let t=window.localStorage.getItem(this.id);if(!t)return;let n=JSON.parse(t);if(!e.guard(n))throw Error("Invalid type!");this.currentValue=n}catch(t){console.error('Unable to retrieve AtomicState "'.concat(e.id,'":'),t)}}saveSession(e){{let t=JSON.stringify(e),n=computeHash(t);window.sessionStorage.setItem(this.sessionId,"".concat(n).concat(t))}}restoreSession(){{let e=window.sessionStorage.getItem(this.sessionId);if(!e)return;let t=e.substring(0,16),n=e.substring(16);if(computeHash(n)!==t){console.error("Atomic state has been corrupted!",this.sessionId);return}try{let e=JSON.parse(n);this.value=e}catch(e){console.error("Atomic state is an invalid JSON!",this.sessionId)}}}constructor(e,t={}){var n,r;this.options=t,this.listeners=new Set,this.sessionId="AtomicState:".concat((AtomicState.counter++).toString(16),"\r"),this.currentValue=t.transform?t.transform(e):e,this.id="AtomicState\n".concat(null!==(r=null===(n=t.storage)||void 0===n?void 0:n.id)&&void 0!==r?r:""),t.storage?this.loadFromStorage():this.restoreSession()}};AtomicState.counter=0;let A="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";function computeHash(e){let t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);t[n%t.length]+=r}return t.map(e=>A[e%A.length]).join("")}let E={axe:new AtomicState("L",{storage:{id:"axe",guard:function(e){return"string"==typeof e}}})},V=null;function getGradientCanvas(){if(!V){(V=document.createElement("canvas")).width=2048,V.height=1;let e=V.getContext("2d");if(!e)throw Error("Unable to get 2D context on canvas!");let t=e.createLinearGradient(0,0,V.width,0);t.addColorStop(0,"#7b7"),t.addColorStop(.1,"#4e4"),t.addColorStop(.5,"#dd2"),t.addColorStop(.9,"#e44"),t.addColorStop(1,"#b77"),e.fillStyle=t,e.fillRect(0,0,V.width,V.height)}return V}var k=n(69365);let R={L:new S.Pa4(1,0,0),T:new S.Pa4(0,1,0),R:new S.Pa4(0,0,1)};let Painter=class Painter{constructor(e,t,n,r){this.canvas=e,this.lastWidth=0,this.lastHeight=0,this.paint=e=>{let{canvas:t,controls:n,camera:r,renderer:o,scene:a}=this;if(t.clientWidth!==this.lastWidth||t.clientHeight!==this.lastHeight){let e=t.clientWidth,a=t.clientHeight;this.lastWidth=e,this.lastHeight=a,t.width=e,t.height=a,r.aspect=e/a,r.updateProjectionMatrix(),r.updateMatrix(),o.setSize(e,a,!1),n.update()}o.render(a,r)};let o=new S.xsS,a=new S.cPb(50,1,1,1e5),i=new S.CP7({alpha:!1,preserveDrawingBuffer:!1,premultipliedAlpha:!1,depth:!0,canvas:e});i.setClearColor(3355443,1),this.scene=o,this.camera=a,this.renderer=i,i.setClearColor(15725048,1);let{x:s,y:l,z:c,sizeX:d,sizeY:u,sizeZ:m}=function(e){let[t,n,r]=e.min,[o,a,i]=e.max;return{x:(t+o)/2,y:(n+a)/2,z:(r+i)/2,sizeX:o-t,sizeY:a-n,sizeZ:i-r}}(t),h=new k.z(a,e);this.controls=h,h.target.set(s,l,c),h.addEventListener("change",this.paint);let[p,f]=function(e,t){let n=new S.ROQ(getGradientCanvas()),r=new S.u9r,o=new S.vpT(e,9);r.setIndex(t),r.setAttribute("position",new S.kB5(o,3,0,!1)),r.setAttribute("normal",new S.kB5(o,3,3,!1)),r.setAttribute("coords",new S.kB5(o,3,6,!1));let a={texCoords:{type:"t",value:n},uniSelector:{value:new S.Pa4(0,1,0)}},i=new S.jyz({uniforms:a,fragmentShader:"precision mediump float;\n\nuniform sampler2D texCoords;\nuniform vec3 uniSelector;\n\nvarying vec3 varCoords; \nvarying vec3 varNormal;\n\nvoid main() {\n    float u = dot(varCoords, uniSelector);\n    vec3 color = texture2D(texCoords, vec2(u, 0.5)).rgb;\n    vec3 n = normalize(varNormal);\n    float light = pow(-n.z, 2.0) * 2.0 + 0.1;\n    gl_FragColor = vec4(light * color, 1.0);\n}",vertexShader:"precision mediump float;\n\n// Attribute `position` is automatically added by ThreeJS.\n// attribute vec4 position;\nattribute vec3 coords;\nvarying vec3 varCoords;\nvarying vec3 varNormal;\n\nvoid main() {\n    varCoords = coords;\n    vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n    varNormal = mat3(modelViewMatrix) * normal;\n    gl_Position = projectionMatrix * modelViewPosition;\n}",side:S._Li,depthTest:!0});n.generateMipmaps=!0,n.needsUpdate=!0;let s=new S.ZAu,l=new S.Kj0(r,i);return s.add(l,new S.Kj0(r,new S.jyz({fragmentShader:"precision mediump float;\n\nvoid main() {\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}",vertexShader:"precision mediump float;\n\n// Attribute `position` is automatically added by ThreeJS.\n// attribute vec4 position;\nattribute vec3 coords;\nvarying vec3 varCoords;\nvarying vec3 varNormal;\n\nvoid main() {\n    varCoords = coords;\n    vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n    varNormal = mat3(modelViewMatrix) * normal;\n    gl_Position = projectionMatrix * (\n        modelViewPosition - vec4(varNormal, 0.0) * 20.0\n    );\n}",side:S.Wl3,depthTest:!0}))),[s,e=>{i.uniforms.uniSelector.value=e}]}(n,r);p.position.set(s,l,c),p.rotation.x=Math.PI,p.rotation.y=-Math.PI/2,o.add(p),a.position.set(s,l,c-1.5*Math.max(d,u,m)),a.lookAt(new S.Pa4(s,l,c)),window.requestAnimationFrame(this.paint),E.axe.addListener(e=>{var t;f(null!==(t=R[e])&&void 0!==t?t:R.L),window.requestAnimationFrame(this.paint)})}};function Scene(e){let{className:t="",meshInfo:n,vert:o,elem:a,onPainterInit:s}=e,l=(0,i.useRef)(null),c=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(l.current){let e=new Painter(l.current,n,o,a);c.current=e,s&&s(e)}},[n,o,a,s]),(0,r.jsx)("canvas",{className:"".concat(t," ").concat(N().Scene),ref:l})}var P=n(5333),I=n.n(P);function Selector(e){let{className:t}=e,[n,o]=function(e){let[t,n]=(0,i.useState)(e.value);return(0,i.useEffect)(()=>{let listener=e=>n(e);return e.addListener(listener),()=>{e.removeListener(listener)}},[e]),[t,t=>e.value=t]}(E.axe);return(0,r.jsxs)("div",{className:"".concat(I().Selector," ").concat(null!=t?t:""),children:[(0,r.jsx)("button",{className:"L"===n?I().selected:I().unselected,onClick:()=>o("L"),children:"Longitudinal"}),(0,r.jsx)("button",{className:"T"===n?I().selected:I().unselected,onClick:()=>o("T"),children:"Transverse"}),(0,r.jsx)("button",{className:"R"===n?I().selected:I().unselected,onClick:()=>o("R"),children:"Radial"})]})}var D=n(97223),B=n.n(D);let F={min:[0,0,0],max:[1,1,1]},T=new Float32Array([0,0,0,1,1,1]),Z=[0,1,2];function Gradient(){return(0,r.jsx)("div",{style:{width:"50px",height:"50px",borderRadius:"5px",border:"none"},className:B().colorramp,ref:e=>{null==e||e.appendChild(getGradientCanvas())}})}var Viewer_Viewer=e=>{let{className:t,meshInfo:n=F,vert:o=T,elem:a=Z}=e,s=(0,x.r)(),[l,c]=(0,i.useState)(null),downloadRender=e=>{if(!l)return;let{clientWidth:t,clientHeight:n}=l.renderer.domElement.parentElement,r=new S.CP7({antialias:!0,alpha:!0,preserveDrawingBuffer:!0,physicallyCorrectColors:!0});r.setSize(3*t,3*n),r.render(l.scene,l.camera),r.domElement.toBlob(t=>{t&&(0,b.saveAs)(t,"".concat(e,".png"))}),r.dispose()};return(0,r.jsxs)(x.I,{className:s.active?void 0:B().fixedAspectRatio,handle:s,children:[(0,r.jsxs)("div",{className:B().topRightCtrlGroup,children:[(0,r.jsx)(j.default,{title:"Download render as a PNG",children:(0,r.jsx)(_.default,{size:"small",onClick:()=>downloadRender("volume_render_CA1"),icon:(0,r.jsx)(y.Z,{})})}),(0,r.jsx)(j.default,{title:"Fullscreen",children:(0,r.jsx)(_.default,{size:"small",className:"ml-1",onClick:()=>{s.active?s.exit():s.enter()},icon:s.active?(0,r.jsx)(g.Z,{}):(0,r.jsx)(w.Z,{})})})]}),(0,r.jsxs)("div",{className:function(e){let t=[B().App];return e&&t.push(e),t.join(" ")}(t),children:[(0,r.jsx)(Scene,{className:B().canvas,meshInfo:n,vert:o,elem:a,onPainterInit:c}),(0,r.jsxs)("div",{className:B().colorrampContainer,children:[(0,r.jsx)("div",{style:{color:"black"},children:"0.0"}),(0,r.jsx)(Gradient,{}),(0,r.jsx)("div",{style:{color:"black"},children:"1.0"})]}),(0,r.jsx)(Selector,{className:B().selector})]})]})},L=n(17931);async function loadData(e){let t=await fetch(e);return await t.arrayBuffer()}async function loadInfo(e){let t=await fetch(e),n=await t.json();return function assertType(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"data";if("unknown"!==t){if("null"===t){if(null!==e)throw Error("Expected ".concat(n," to be null and not a ").concat(typeof e,"!"));return}if("string"==typeof t){if(typeof e!==t)throw Error("Expected ".concat(n," to be a string and not a ").concat(typeof e,"!"));return}if(Array.isArray(t)){let[r]=t;switch(r){case"array":(function(e,t,n){if(!Array.isArray(e))throw Error("Expected ".concat(t," to be an array and not a ").concat(typeof e,"!"));let[,r]=n;for(let n=0;n<e.length;n+=1)assertType(e[n],r,"".concat(t,"[").concat(n,"]"))})(e,n,t);return;case"map":(function(e,t,n){if(!(!(!e||Array.isArray(e))&&"object"==typeof e))throw Error("Expected ".concat(t," to be an object and not a ").concat(typeof e,"!"));let[,r]=n;for(let n of Object.keys(e))"string"==typeof n&&assertType(e[n],r,"".concat(t,"[").concat(n,"]"))})(e,n,t);return;case"?":(function(e,t,n){if(void 0===e)return;let[,r]=n;assertType(e,r,t)})(e,n,t);return;case"|":(function(e,t,n){let[,...r]=n,o=Error("No type has been defined for this alternative: ".concat(JSON.stringify(n),"!"));for(let n of r)try{assertType(e,n,t);return}catch(e){e instanceof Error&&(o=e)}throw o})(e,n,t);return;default:if(r.startsWith("array(")){let o=parseInt(r.substring(6,r.length-1),10);(function(e,t,n,r){if(!Array.isArray(e))throw Error("Expected ".concat(t," to be an array and not a ").concat(typeof e,"!"));if(e.length!==r)throw Error("".concat(t," was expected to have a length of ").concat(r,", but we got ").concat(e.length,"!"));let[,o]=n;for(let n=0;n<e.length;n+=1)assertType(e[n],o,"".concat(t,"[").concat(n,"]"))})(e,n,t,o);return}throw Error("Don't know how to create a type guard for this kind of type: ".concat(JSON.stringify(t)))}}if("object"!=typeof e)throw Error("Expected ".concat(n," to be an object and not a ").concat(typeof e,"!"));for(let r of Object.keys(t)){if("string"!=typeof r)continue;let o=t[r];o&&assertType(e[r],t[r],"".concat(n,".").concat(r))}}}(n,{min:["array(3)","number"],max:["array(3)","number"]}),n}var coordinates_viewer_CoordinatesViewer=()=>{let[e,t]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{let start=async()=>{let e=await loadInfo("".concat(L.$N,"/3d/2_reconstruction-data/coordinates/mesh.json")),t=new Uint32Array(await loadData("".concat(L.$N,"/3d/2_reconstruction-data/coordinates/elem.dat"))),n=new Float32Array(await loadData("".concat(L.$N,"/3d/2_reconstruction-data/coordinates/vert.dat"))),o=document.getElementById("root"),a=(0,v.createRoot)(o);a.render((0,r.jsx)(Viewer_Viewer,{meshInfo:e,vert:n,elem:Array.from(t)}))};start()},[]),(0,r.jsx)("div",{id:"root",children:e&&(0,r.jsx)("p",{children:"Loading..."})})},z=n(42978),G=n(61267),H=n(69313),O=n(71376),M=n(8404),J=n(82718),W=n(78433),q=n(67264),U=n(50818),Q=n(35930),X=n(22633),$=n(28354),K=n(33638),Y=(0,$.Z)(()=>{let e=(0,l.useRouter)(),[t,n]=(0,i.useState)(!1),{volume_section:o}=e.query,setVolumeSectionQuery=t=>{e.push({query:{volume_section:t}},void 0,{shallow:!0})};RegExp("region"===o?"CA1":o,"i");let a=[{title:"Volume section",key:"volume_section",values:G.jo,setFn:setVolumeSectionQuery}];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(O.Z,{theme:2,hasData:!0,children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row w-full lg:items-center mt-40 lg:mt-0",children:[(0,r.jsx)("div",{className:"w-full lg:w-1/2 md:w-full md:flex-none mb-8 md:mb-8 lg:pr-0",children:(0,r.jsxs)(J.Z,{children:[(0,r.jsx)(W.Z,{title:"Volume",subtitle:"Reconstruction Data",theme:2}),(0,r.jsx)("div",{role:"information",children:(0,r.jsx)(q.Z,{children:(0,r.jsxs)("p",{children:["We combined a publicly available ",(0,r.jsx)(d(),{href:"http://cng.gmu.edu/hippocampus3d/",className:"link theme-".concat(2),children:"atlas"})," with a process of coordinate extraction and ",(0,r.jsx)(d(),{href:"/experimental-data/layer-anatomy/",className:"link theme-".concat(2),children:"layer thickness estimation"})," to reconstruct the volume of CA1. From the entire CA1, we can obtain subvolumes of particular interest, such as cylinders and slices, at any desired location."]})})})]})}),(0,r.jsx)("div",{className:"flex flex-col-reverse md:flex-row-reverse gap-8 mb-12 md:mb-0 mx-8 md:mx-0 lg:w-1/2 md:w-full flex-grow md:flex-none justify-center",children:(0,r.jsxs)("div",{className:"selector__column selector__column--lg theme-".concat(2," w-full"),children:[(0,r.jsx)("div",{className:"selector__head theme-".concat(2),children:"Choose a layer"}),(0,r.jsx)("div",{className:"selector__body",children:(0,r.jsx)(X.Z,{value:o,onSelect:setVolumeSectionQuery,theme:2})})]})})]})}),(0,r.jsxs)(U.Z,{theme:2,navItems:[{id:"volumeSection",label:"Volume"},{id:"coordinatesSection",label:"Coordinates"}],quickSelectorEntries:a,children:[(0,r.jsxs)(Q.Z,{id:"volume",title:"Volume",properties:[o],children:[(0,r.jsx)("h2",{children:"region"===o?(0,r.jsx)("span",{children:"Region CA1"}):"cylinder"===o?(0,r.jsx)("span",{children:"Cylindrical subvolume of radius 300 um from the dorsal CA1."}):"slice"===o?(0,r.jsx)("span",{children:"Coronal slice of 400 um from the dorsal CA1."}):null}),(0,r.jsx)("h3",{children:"3D volume viewer"}),(0,r.jsx)(s.default,{spinning:!t,children:(0,r.jsx)("div",{className:"graph no-padding",children:(0,r.jsx)(volume_viewer,{meshPath:"".concat(L.$N,"/3d/2_reconstruction-data/volume/volume.obj"),volumeSection:o,onReady:()=>n(!0)})})}),(0,r.jsxs)("p",{className:"mt-4",children:["Related: ",(0,r.jsx)(d(),{href:"/experimental-data/layer-anatomy/",children:"Experimental data - Layer anatomy"})]}),(0,r.jsxs)("div",{className:"mt-12",children:[(0,r.jsx)("h2",{className:"text-lg",children:"Volume analysis"}),(0,r.jsx)(H.Z,{path:"".concat(L.$N,"/2_reconstruction-data/volume/volume_analysis.json"),children:e=>(0,r.jsxs)(r.Fragment,{children:[e&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(M.Z,{facts:e.values})}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)(K.Z,{onClick:()=>(0,z.KO)(e.values,"volume_analysis.json"),theme:2,children:" Volume analysis "})})]})})]})]}),(0,r.jsxs)(Q.Z,{id:"coordinatesSection",title:"Coordinates",className:"mt-4",properties:[o],children:[(0,r.jsx)("p",{children:"Due to its curvature and irregularities, the volume of CA1 is difficult to manipulate. For this reason, we define a coordinate system that follows the hippocampal axes (longitudinal, transverse, radial)."}),(0,r.jsx)("div",{className:"graph no-padding flex-col",children:(0,r.jsx)(s.default,{spinning:!t,children:(0,r.jsx)(coordinates_viewer_CoordinatesViewer,{})})})]})]})]})},{key:"volume_section",defaultQuery:G.defaultSelection.reconstructionData.volume});function VolumePage(){let e={title:"Volume - Reconstruction Data | The Hippocampus Hub",description:"Explore the reconstructed volume of the CA1 region of the hippocampus. Visualize the 3D structure of CA1, including detailed layers and coordinates, and extract subvolumes of particular interest for further analysis.",keywords:["Hippocampus","CA1 Volume","3D Structure","Reconstruction Data","Neuroscience","Blue Brain Project","Coordinate System"],author:"Blue Brain Project",creator:"EPFL Blue Brain Project",publisher:"The Hippocampus Hub"};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(a(),{children:[(0,r.jsx)("title",{children:e.title}),(0,r.jsx)("meta",{name:"description",content:e.description}),(0,r.jsx)("meta",{name:"keywords",content:e.keywords.join(", ")}),(0,r.jsx)("meta",{name:"author",content:e.author}),(0,r.jsx)("meta",{name:"creator",content:e.creator}),(0,r.jsx)("meta",{name:"publisher",content:e.publisher})]}),(0,r.jsx)(Y,{})]})}},62249:function(e){e.exports={Scene:"Scene_Scene__w0BtV"}},5333:function(e){e.exports={Selector:"Selector_Selector__VUaVF",selected:"Selector_selected__q_nDm",unselected:"Selector_unselected__IVu7D"}},97223:function(e){e.exports={fixedAspectRatio:"viewer_fixedAspectRatio__sLXZy",App:"viewer_App__hb47X",canvas:"viewer_canvas__jn8nV",colorrampContainer:"viewer_colorrampContainer__Wc0AE",colorramp:"viewer_colorramp__0uORu",selector:"viewer_selector__l0_Sa",topRightCtrlGroup:"viewer_topRightCtrlGroup__Brav4"}},2064:function(e){e.exports={fixedAspectRatio:"volume-viewer_fixedAspectRatio__On_lG",container:"volume-viewer_container__o8FSH",coloredCheckbox:"volume-viewer_coloredCheckbox__9bhIF",coloredBox:"volume-viewer_coloredBox__vgrjm",settingBtn:"volume-viewer_settingBtn__DUNhE",fullscreenBtn:"volume-viewer_fullscreenBtn__HdEG7",config:"volume-viewer_config__3a6ZN",legend:"volume-viewer_legend__bshzh",topRightCtrlGroup:"volume-viewer_topRightCtrlGroup__t06Be",legendDivider:"volume-viewer_legendDivider__0yp_a"}}},function(e){e.O(0,[3737,7056,4055,685,9242,9227,9672,9612,8287,5653,9774,2888,179],function(){return e(e.s=17388)}),_N_E=e.O()}]);
//# sourceMappingURL=volume-0f18b47c4b08c0d1.js.map