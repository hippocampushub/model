(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9895],{5298:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/digital-reconstructions/region",function(){return i(12175)}])},12175:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return DigRecRegionPage}});var s=i(85893),n=i(9008),r=i.n(n),o=i(67294),l=i(89552),a=i(11163),c=i(71376),h=i(8404),d=i(69313),u=i(82718),m=i(78433),v=i(67264),p=i(50818),g=i(35930),x=i(61267),f=i(28354),j=i(17931),w=i(2801),y=i(83848),b=i(73265),_=i(35741),C=i(26401),R=i(65400),S=i(31059),E=i(1825),N=i(94055),k=i(23493),P=i.n(k),z=i(79753),O=i(87011),V=i(99477);let RendererCtrl=class RendererCtrl{get render(){if(this.stopped)return!1;if(this.countinuousRenderCounter)return!0;if(this.stopTime){let e=Date.now();return this.stopTime>e||(this.stopTime=null,!1)}let{once:e}=this;return this.once=!1,e}renderOnce(){this.once=!0}renderFor(e){let t=Date.now();this.stopTime&&this.stopTime>t+e||(this.stopTime=t+e)}renderUntilStopped(){return this.countinuousRenderCounter+=1,()=>{this.countinuousRenderCounter-=1}}stop(){this.stopped=!0}constructor(){this.stopped=!1,this.countinuousRenderCounter=0,this.once=!0,this.stopTime=null}};var Z=i(93162);function parseCssColor(e){return parseInt(e.replace("#",""),16)}let VolumeViewer=class VolumeViewer{async init(e,t){try{this.meshPath=e,this.volumeSection=t,this.initCanvas(),this.initRenderer(),this.initScene(),this.initCamera(),this.initControls(),this.initEvents(),this.initObservers(),this.initMaterials(),await this.initMeshes(),this.alignCamera(),this.ctrl.renderOnce(),this.startRenderLoop()}catch(e){}}resize(){let{clientWidth:e,clientHeight:t}=this.container;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.ctrl.renderOnce()}setVolumeSection(e,t){this.volumeSection=e,Object.entries(this.layerMesh).forEach(i=>{let[s,n]=i;if("region"===s)n.visible=!0;else{let i=s.replace("neurons_","");n.visible=i===e&&t[i]}}),this.ctrl.renderOnce()}setLayerVisibility(e){Object.entries(e).forEach(e=>{let[t,i]=e;if("region"===t)this.layerMesh.region.visible=!0;else{let e="neurons_".concat(t);this.layerMesh[e]&&(this.layerMesh[e].visible=t===this.volumeSection&&i)}}),this.ctrl.renderOnce()}downloadRender(e){let{clientWidth:t,clientHeight:i}=this.renderer.domElement.parentElement,s=new V.CP7({antialias:!0,alpha:!0,preserveDrawingBuffer:!0,physicallyCorrectColors:!0});s.setSize(3*t,3*i),s.render(this.scene,this.camera),s.domElement.toBlob(t=>(0,Z.saveAs)(t,"".concat(e,".png"))),s.dispose()}destroy(){Object.values(this.material).forEach(e=>e.dispose()),Object.values(this.layerMesh).forEach(e=>e.geometry.dispose()),this.renderer&&(this.renderer.domElement.removeEventListener("wheel",this.onUserInteract),this.renderer.domElement.removeEventListener("mousemove",this.onUserInteract),this.renderer.domElement.removeEventListener("touchmove",this.onUserInteract),this.renderer.domElement.removeEventListener("pointermove",this.onUserInteract)),this.resizeObserver&&this.resizeObserver.unobserve(this.container),this.controls&&this.controls.dispose(),this.renderer&&this.renderer.dispose(),this.container&&this.canvas&&this.container.removeChild(this.canvas)}initCanvas(){this.canvas=document.createElement("canvas"),this.container.appendChild(this.canvas)}initRenderer(){this.renderer=new V.CP7({canvas:this.canvas,antialias:!0});let{clientWidth:e,clientHeight:t}=this.container;this.renderer.setSize(e,t),this.renderer.setPixelRatio(window.devicePixelRatio||1)}initScene(){this.scene=new V.xsS,this.scene.background=new V.Ilk("#EFF1F8"),this.scene.add(new V.Mig(5592405))}initCamera(){let{clientWidth:e,clientHeight:t}=this.container;this.camera=new V.cPb(45,e/t,1,3e4),this.scene.add(this.camera),this.camera.add(new V.cek(13290186,.9))}initControls(){this.controls=new z.$(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.zoomSpeed=.5,this.controls.rotateSpeed=.8,this.controls.maxDistance=2e4}initEvents(){let e={capture:!1,passive:!0};this.onUserInteract=P()(()=>this.ctrl.renderFor(4e3),100).bind(this),this.canvas.addEventListener("wheel",this.onUserInteract,e),this.canvas.addEventListener("mousemove",this.onUserInteract,e),this.canvas.addEventListener("touchmove",this.onUserInteract,e),this.canvas.addEventListener("pointermove",this.onUserInteract,e)}initObservers(){this.resizeObserver=new ResizeObserver(()=>setTimeout(()=>this.resize(),0)),this.resizeObserver.observe(this.container)}initMaterials(){this.material={region:new V.YBo({color:parseCssColor("#3b4165"),wireframe:!0,transparent:!0,opacity:.05}),neurons:new V.YBo({color:parseCssColor("#3b4165")}),cylinder:new V.YBo({color:parseCssColor("#3b4165")}),slice:new V.YBo({color:parseCssColor("#3b4165")})}}initMeshes(){let e=new O.L;return new Promise(t=>{e.load(this.meshPath,e=>{e.traverse(e=>{if(!e.isMesh)return;let{name:t}=e;if("region"===t)e.material=this.material.region,e.visible=!0;else if("neurons_region"===t)e.material=this.material.neurons,e.visible="region"===this.volumeSection;else{let i=t.replace("neurons_","");e.material=this.material[i],e.visible=t.includes(this.volumeSection)}this.layerMesh[t]=e}),this.scene.add(e),this.group=e,t()})})}alignCamera(){let e=new V.ZzF().setFromObject(this.group),t=new V.Pa4;e.getCenter(t);let i=new V.Pa4;e.getSize(i);let s=i.x;this.camera.position.z=t.z,this.camera.position.y=t.y;let n=s/Math.tan(Math.PI*this.camera.fov/360)*1.15;this.camera.position.x=t.x-n,this.controls.target=t,this.controls.update()}startRenderLoop(){if(!this.ctrl.stopped){if(!this.renderer||!this.scene||!this.camera||!this.controls){console.warn("Renderer, scene, camera, or controls not initialized. Stopping render loop.");return}this.ctrl.render&&(this.controls.update(),this.renderer.render(this.scene,this.camera)),requestAnimationFrame(this.startRenderLoop.bind(this))}}constructor(e){this.meshPath=null,this.volumeSection=null,this.container=null,this.resizeObserver=null,this.canvas=null,this.renderer=null,this.scene=null,this.camera=null,this.controls=null,this.ctrl=new RendererCtrl,this.onUserInteract=()=>{},this.material={},this.group=null,this.layerMesh={},this.container=e}};var B=i(17251),L=i.n(B);let F=x.ug.reduce((e,t)=>(e[t]=!0,e),{}),A="undefined"!=typeof document&&(document.fullscreenEnabled||document.webkitFullscreenEnabled);var RegionViewer=e=>{let{meshPath:t,volumeSection:i,onReady:n}=e,r=(0,o.useRef)(null),[a,c]=(0,o.useState)(null),[h,d]=(0,o.useState)(!1),u=(0,w.r)(),[m,v]=(0,o.useState)(F),[p,g]=(0,o.useState)(!0),[f,j]=(0,o.useState)(!0),[k,P]=(0,o.useState)(!1),updateLayerVisibility=e=>{let t={...m,...e};v(t),null==a||a.setLayerVisibility(t)},updateRegionMaskVisibility=e=>{g(e)};return(0,o.useEffect)(()=>{if(!t||!r.current)return;let e=r.current,s=new VolumeViewer(e);return c(s),s.init(t,i).then(()=>{c(s),j(!1),setTimeout(()=>{P(!0),null==n||n()},100)}).catch(e=>{console.error("Error initializing RegionViewer:",e),j(!1)}),()=>{s.destroy()}},[t,i,n]),(0,o.useEffect)(()=>{null==a||a.setVolumeSection(i,m)},[a,i,m]),(0,s.jsx)("div",{children:(0,s.jsx)(w.I,{className:u.active?void 0:L().fixedAspectRatio,handle:u,children:(0,s.jsxs)("div",{className:L().container,ref:r,children:[(f||!k)&&(0,s.jsx)("div",{className:L().loadingOverlay,children:(0,s.jsx)(l.default,{tip:"Loading...",size:"large",style:{color:x.x8.blue}})}),(0,s.jsx)(N.default,{title:"Viewer settings",children:(0,s.jsx)(R.default,{className:L().settingBtn,size:"small",onClick:()=>d(!0),icon:(0,s.jsx)(_.Z,{})})}),(0,s.jsxs)("div",{className:L().topRightCtrlGroup,children:[(0,s.jsx)(N.default,{title:"Download render as a PNG",children:(0,s.jsx)(R.default,{size:"small",onClick:()=>{let e="volume_render_CA1_".concat(i);null==a||a.downloadRender(e)},icon:(0,s.jsx)(C.Z,{})})}),A&&(0,s.jsx)(N.default,{title:"Fullscreen",children:(0,s.jsx)(R.default,{size:"small",className:"ml-1",onClick:()=>{u.active?u.exit():u.enter()},icon:u.active?(0,s.jsx)(b.Z,{}):(0,s.jsx)(y.Z,{})})})]}),(0,s.jsxs)(E.Z,{title:"Viewer settings",placement:"left",closable:!0,width:240,onClose:()=>d(!1),open:h,getContainer:!1,style:{position:"absolute"},children:[(0,s.jsx)("div",{children:(0,s.jsx)(S.default,{className:L().coloredCheckbox,style:{"--checkbox-color":"black"},checked:p,onChange:e=>updateRegionMaskVisibility(e.target.checked),children:"CA1 region mask"})}),(0,s.jsx)("h4",{className:"mt-2",children:"Layers"}),x.ug.map(e=>(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)(S.default,{className:L().coloredCheckbox,style:{"--checkbox-color":"black"},checked:m[e],onChange:t=>updateLayerVisibility({[e]:t.target.checked}),children:e})},e))]})]})})})},M=i(22633),T=i(33638),D=i(42978),I=(0,f.Z)(()=>{let e=(0,a.useRouter)(),{volume_section:t}=e.query,[i,n]=(0,o.useState)(!1),setVolumeSectionQuery=t=>{e.push({query:{volume_section:t}},void 0,{shallow:!0})},r=[{title:"Volume section",key:"volume_section",values:x.jo,setFn:setVolumeSectionQuery}],f=null!=t?t:x.defaultSelection.digitalReconstruction.region.volume_section;return f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Z,{theme:3,hasData:!0,children:(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row w-full lg:items-center mt-40 lg:mt-0",children:[(0,s.jsx)("div",{className:"w-full lg:w-1/2 md:w-full md:flex-none mb-8 md:mb-8 lg:pr-0",children:(0,s.jsxs)(u.Z,{children:[(0,s.jsx)(m.Z,{title:"Region",subtitle:"Digital Reconstructions",theme:3}),(0,s.jsx)("div",{role:"information",children:(0,s.jsx)(v.Z,{children:(0,s.jsx)("p",{children:"Reconstruction data are combined to produce an instance of the CA1 network model."})})})]})}),(0,s.jsx)("div",{className:"flex flex-col-reverse md:flex-row-reverse gap-8 mb-12 md:mb-0 mx-8 md:mx-0 lg:w-1/2 md:w-full flex-grow md:flex-none justify-center",children:(0,s.jsxs)("div",{className:"selector__column selector__column--lg theme-".concat(3," w-full"),children:[(0,s.jsx)("div",{className:"selector__head theme-".concat(3),children:"Choose a layer"}),(0,s.jsx)("div",{className:"selector__body",children:(0,s.jsx)(M.Z,{value:t,onSelect:setVolumeSectionQuery,theme:3})})]})})]})}),(0,s.jsxs)(p.Z,{theme:3,visible:!!t,navItems:[{id:"ViewerSection",label:"Viewer"},{id:"factsheetSection",label:"Factsheet"}],quickSelectorEntries:r,children:[(0,s.jsxs)(g.Z,{id:"viewerSection",title:"Viewer",properties:[t],children:[(0,s.jsx)("h3",{children:(e=>{switch(e){case"region":return"Region CA1.";case"cylinder":return"Cylindrical subvolume of radius 300 um from the dorsal CA1.";case"slice":return"Coronal slice of 400 um from the dorsal CA1.";default:return""}})(f)}),(0,s.jsx)("div",{className:"text-base mb-2",children:"The image shows soma positions."}),(0,s.jsx)("div",{className:"graph no-padding",children:(0,s.jsx)(RegionViewer,{meshPath:"".concat(j.$N,"/3d/3_digital-reconstruction/region/region.obj"),volumeSection:f,onReady:()=>n(!0)})})]}),(0,s.jsx)(g.Z,{id:"factsheetSection",title:"Factsheet",children:f&&(0,s.jsx)(d.Z,{path:"".concat(j.$N,"/3_digital-reconstruction/region/").concat(t,"/factsheet.json"),children:(e,t)=>(0,s.jsx)(l.default,{spinning:t,children:e&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{className:"mt-2",children:"Neuronal anatomy"}),(0,s.jsx)(h.Z,{facts:e.neuronalAnatomy}),(0,s.jsx)("h3",{className:"mt-3",children:"Neuronal physiology"}),(0,s.jsx)(h.Z,{facts:e.neuronalPhysiology}),(0,s.jsx)("h3",{className:"mt-3",children:"Synaptic anatomy"}),(0,s.jsx)(h.Z,{facts:e.synapticAnatomy}),(0,s.jsx)("h3",{className:"mt-3",children:"Synaptic physiology"}),(0,s.jsx)(h.Z,{facts:e.synapticPhysiology}),(0,s.jsx)("h3",{className:"mt-3",children:"Network anatomy"}),(0,s.jsx)(h.Z,{facts:e.networkAnatomy}),(0,s.jsx)("h3",{className:"mt-3",children:"Schaffer collaterals"}),(0,s.jsx)(h.Z,{facts:e.schafferCollaterals}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(T.Z,{theme:3,onClick:()=>(0,D.KO)(e,"region-factsheet.json"),children:"Factsheet"})})]})})})})]})]}):null},{key:"volume_section",defaultQuery:x.defaultSelection.digitalReconstruction.region});function DigRecRegionPage(){let e={title:"Region | Digital Reconstructions | The Hippocampus Hub",description:"Examine the reconstructed digital model of the CA1 region in the hippocampus. Analyze the neuronal populations, layers, and connectivity patterns that shape this vital hippocampal region.",keywords:["CA1 Region","Hippocampus","Digital Reconstructions","Neuronal Populations","Neuroscience","Blue Brain Project"],author:"Blue Brain Project",creator:"EPFL Blue Brain Project",publisher:"The Hippocampus Hub"};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r(),{children:[(0,s.jsx)("title",{children:e.title}),(0,s.jsx)("meta",{name:"description",content:e.description}),(0,s.jsx)("meta",{name:"keywords",content:e.keywords.join(", ")}),(0,s.jsx)("meta",{name:"author",content:e.author}),(0,s.jsx)("meta",{name:"creator",content:e.creator}),(0,s.jsx)("meta",{name:"publisher",content:e.publisher})]}),(0,s.jsx)(I,{})]})}},17251:function(e){e.exports={fixedAspectRatio:"volume-viewer_fixedAspectRatio___KBBO",container:"volume-viewer_container__nRG_R",coloredCheckbox:"volume-viewer_coloredCheckbox__jgdoh",coloredBox:"volume-viewer_coloredBox__wXD2L",settingBtn:"volume-viewer_settingBtn__4TWJe",fullscreenBtn:"volume-viewer_fullscreenBtn__1Gzz1",config:"volume-viewer_config__BWQi8",legend:"volume-viewer_legend__U7qKT",topRightCtrlGroup:"volume-viewer_topRightCtrlGroup__lFqHL",legendDivider:"volume-viewer_legendDivider__zkaFA",loadingOverlay:"volume-viewer_loadingOverlay__xhUEL",loadingContent:"volume-viewer_loadingContent__88aPA"}}},function(e){e.O(0,[1228,3737,7056,4055,9006,685,9242,9227,3825,9886,8287,5653,9774,2888,179],function(){return e(e.s=5298)}),_N_E=e.O()}]);